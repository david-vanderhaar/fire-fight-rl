(window["webpackJsonpfire-fight-rl"]=window["webpackJsonpfire-fight-rl"]||[]).push([[0],{143:function(e,t,a){e.exports=a(326)},148:function(e,t,a){},326:function(e,t,a){"use strict";a.r(t);var n=a(6),r=a.n(n),i=a(85),s=a.n(i),c=(a(148),a(0)),o=a(1),u=a(5),l=a(2),h=a(4),p=(a(88),a(3)),d=a(142),f=a.n(d),g=0,y=1,m=2,b=a(55),v=a(21),O=a(14),j=a.n(O),k=a(22),x=a(23),w=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;if(!(e<=0))return new Promise((function(t){return setTimeout(t,e)}))},E=function(e){return e[Math.floor(Math.random()*e.length)]},A=function(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e))+e},C=function(e){return"".concat(e.x,",").concat(e.y)},T=function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4,r=e.map,i=function(t,a){var n=r[t+","+a];return!!n&&e.tileKey[n.type].passable},s=new x.e.AStar(t.x,t.y,i,{topology:n}),c=[];return s.compute(a.x,a.y,(function(e,t){c.push({x:e,y:t})})),c.slice(1)},P=function(e,t,a,n,r){return T(e,t,a,n).slice(0,r+1)},S=function(e){var t=Object.keys(e),a=E(t).split(",");return{coordinates:{x:parseInt(a[0]),y:parseInt(a[1])},text:a}},I=function(e){return e.filter((function(e){return e.hasOwnProperty("durability")}))},R=function(e){return 2/3*(Math.pow(e,3)-9*Math.pow(e,2)+32*e-18)},D=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,n=R(a),r=[],i=0;i<n;i++){var s=Math.round(e+Math.cos(2*Math.PI/n*i)*a),c=Math.round(t+Math.sin(2*Math.PI/n*i)*a);r.push({x:s,y:c})}return r},N=a(12),L=a(8),M=a(25),_=a.n(M),B=a(16),G=a.n(B),U=function(e){if(e.energy=0,e.pos){var t=e.game.map[C(e.pos)];e.game.map[C(e.pos)].entities=t.entities.filter((function(t){return t.id!==e.id}))}e.game.engine.removeStatusEffectByActorId(e.id),e.game.draw(),e.active=!1},F="#424242",W="#606b79",H="#B7C3CD",q="#CED5DD",z="#E16264",K={base03:"#002b36",base02:"#073642",base01:"#586e75",base00:"#657b83",base0:"#839496",base1:"#93a1a1",base2:"#eee8d5",base3:"#fdf6e3",yellow:"#b58900",orange:"#cb4b16",red:"#dc322f",magenta:"#d33682",violet:"#6c71c4",blue:"#268bd2",cyan:"#2aa198",green:"#859900"},Y={GROUND:{background:K.base03,foreground:K.base01,character:".",sprite:"\ue8a2",passable:!0},FLOOR:{background:K.base02,foreground:K.base0,character:"",passable:!0},SAFE_FLOOR:{background:K.base02,foreground:K.base0,character:"",passable:!0},BURNT:{background:K.base03,foreground:K.red,character:"X",sprite:"\ue8bb",passable:!0,animation:[{background:K.base03,foreground:K.red,character:"X",sprite:"\ue8bb",passable:!0},{background:K.base03,foreground:K.red,character:"x",sprite:"\ue8bb",passable:!0},{background:K.base03,foreground:K.red,character:"X",sprite:"\ue8bb",passable:!0},{background:K.base03,foreground:K.orange,character:"x",sprite:"\ue8bb",passable:!0},{background:K.base03,foreground:K.orange,character:"X",sprite:"\ue8bb",passable:!0},{background:K.base03,foreground:K.yellow,character:"x",sprite:"\ue8bb",passable:!0},{background:K.base03,foreground:K.red,character:"X",sprite:"\ue8bb",passable:!0}]},WET:{background:K.base03,foreground:K.blue,character:"=",sprite:"\ue8ca",passable:!0,animation:[{background:K.base03,foreground:K.blue,character:"=",sprite:"\ue8ca",passable:!0},{background:K.base03,foreground:K.blue,character:"~",sprite:"\ue8ca",passable:!0},{background:K.base03,foreground:K.blue,character:"=",sprite:"\ue8ca",passable:!0},{background:K.base03,foreground:K.base0,character:"~",sprite:"\ue8ca",passable:!0},{background:K.base03,foreground:K.base1,character:"=",sprite:"\ue8ca",passable:!0},{background:K.base03,foreground:K.base1,character:"~",sprite:"\ue8ca",passable:!0},{background:K.base03,foreground:K.blue,character:"=",sprite:"\ue8ca",passable:!0}]},WALL:{background:K.base02,foreground:K.base2,character:"#",sprite:"\ue802",passable:!1},DOOR:{background:K.base02,foreground:K.base0,character:"+",sprite:"\ue86d",passable:!0},SAFE:{background:K.base02,foreground:K.green,character:"+",sprite:"\ue8b2",passable:!0},WATER:{animation:[{background:"#424242",foreground:"#9dc3d3",character:"\u2591",passable:!1},{background:"#424242",foreground:"#9dc3d3",character:"\u2591",passable:!1},{background:"#424242",foreground:"#9dc3d3",character:"\u2591",passable:!1},{background:"#424242",foreground:"#9dc3d3",character:"\u2591",passable:!1},{background:"#424242",foreground:"#9dc3d3",character:"\u2591",passable:!1},{background:"#424242",foreground:"#9dc3d3",character:"\u2591",passable:!1},{background:"#424242",foreground:"#9dc3d3",character:"\u2591",passable:!1},{background:"#424242",foreground:"#9dc3d3",character:"\u2591",passable:!1},{background:"#424242",foreground:"#9dc3d3",character:"\u2591",passable:!1},{background:"#424242",foreground:"#9dc3d3",character:"\u2591",passable:!1},{background:"#424242",foreground:"#9dc3d3",character:"\u2591",passable:!1},{background:"#424242",foreground:"#8aa",character:"\u2592",passable:!1},{background:"#424242",foreground:"#8aa",character:"\u2593",passable:!1}],background:"#9dc3d3",character:"\u2591",passable:!1}},X={N:[0,-1],NE:[1,-1],W:[-1,0],NW:[-1,-1],SW:[-1,1],S:[0,1],SE:[1,1],E:[1,0],NONE:[0,0]},V="HEAD",J="TORSO",Q="BACK",Z="HAND",$="FEET",ee="GENERIC",te=function(){return[{type:V,name:"head",item:null},{type:J,name:"torso",item:null},{type:Q,name:"back",item:null},{type:Z,name:"left_hand",item:null},{type:Z,name:"right_hand",item:null},{type:$,name:"feet",item:null}]},ae=function(){return[{type:ee,name:"slot_1",item:null},{type:ee,name:"slot_2",item:null}]},ne={verticalLine:{x_offset:1,y_offset:1,positions:[{x:0,y:0,taken:!1},{x:0,y:1,taken:!1},{x:0,y:-1,taken:!1}]},smallSquare:{x_offset:1,y_offset:1,positions:[{x:0,y:0,taken:!1},{x:0,y:1,taken:!1},{x:1,y:1,taken:!1},{x:1,y:0,taken:!1}]},square:{x_offset:2,y_offset:2,positions:[{x:0,y:0,taken:!1},{x:0,y:1,taken:!1},{x:1,y:1,taken:!1},{x:1,y:0,taken:!1},{x:1,y:-1,taken:!1},{x:0,y:-1,taken:!1},{x:-1,y:-1,taken:!1},{x:-1,y:0,taken:!1},{x:-1,y:1,taken:!1}]},bigSquare:{x_offset:2,y_offset:2,positions:[{x:0,y:0,taken:!1},{x:0,y:1,taken:!1},{x:1,y:1,taken:!1},{x:1,y:0,taken:!1},{x:1,y:-1,taken:!1},{x:0,y:-1,taken:!1},{x:-1,y:-1,taken:!1},{x:-1,y:0,taken:!1},{x:-1,y:1,taken:!1},{x:0,y:1,taken:!1},{x:2,y:2,taken:!1},{x:2,y:0,taken:!1},{x:2,y:-2,taken:!1},{x:0,y:-2,taken:!1},{x:-2,y:-2,taken:!1},{x:-2,y:0,taken:!1},{x:-2,y:2,taken:!1}]},circle:{x_offset:0,y_offset:0,positions:[].concat(Object(v.a)(D(0,0,2)),Object(v.a)(D(0,0,3)))}},re={default:{renderer:{character:"*",color:"black",background:"white"}},fail:{renderer:{character:"x",color:"black",background:"red"}},succede:{renderer:{character:"x",color:K.base3,background:K.green}},damage:{renderer:{character:"*",color:"darkred",background:"red"}},leaf:{renderer:{character:"\u2724",color:"#36635b",background:"#F0D8C0"}},water:{renderer:{character:"~",color:K.base3,background:K.blue}}},ie=0,se=1,ce=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],oe=a(32),ue={INFORMATION:{color:H,backgroundColor:F},ACTION:{color:W,backgroundColor:q},DANGER:{color:z,backgroundColor:F},STATUS_EFFECT:{color:K.base3,backgroundColor:K.violet},ERROR:{color:K.base3,backgroundColor:K.yellow}},le=function e(t){var a=t.text,n=void 0===a?"":a,r=t.type,i=void 0===r?ue.INFORMATION:r;Object(c.a)(this,e);var s=_()();this.id=s,this.text=n,this.type=i},he="Axe",pe="Water Gun",de=function(e){return new Ze({game:e.game,name:pe,passable:!0,attackDamage:0,equipmentType:ee,renderer:{character:"w",sprite:"\ue890",color:K.blue,background:""}})},fe=function(e){return new $e({game:e.game,name:"Fire Jacket",passable:!0,defense:1,equipmentType:ee,renderer:{character:"J",sprite:"\ue89b",color:K.magenta,background:""}})},ge=a(18);console.log(window.PUBLIC_URL);var ye={fire_0:new ge.Howl({src:[window.PUBLIC_URL+"/sounds/fire-00.mp3"],volume:.5,loop:!0}),fire_1:new ge.Howl({src:[window.PUBLIC_URL+"/sounds/fire-01.mp3"],volume:.05,loop:!0}),scream_0:new ge.Howl({src:[window.PUBLIC_URL+"/sounds/scream-00.wav"]}),scream_1:new ge.Howl({src:[window.PUBLIC_URL+"/sounds/scream-01.wav"]}),scream_2:new ge.Howl({src:[window.PUBLIC_URL+"/sounds/scream-02.wav"]}),water_0:new ge.Howl({src:[window.PUBLIC_URL+"/sounds/water-04.wav"]}),water_1:new ge.Howl({src:[window.PUBLIC_URL+"/sounds/water-05.wav"]}),chop_0:new ge.Howl({src:[window.PUBLIC_URL+"/sounds/chop-00.wav"]}),chop_1:new ge.Howl({src:[window.PUBLIC_URL+"/sounds/chop-01.wav"]}),equip_0:new ge.Howl({src:[window.PUBLIC_URL+"/sounds/equip-00.wav"]}),equip_1:new ge.Howl({src:[window.PUBLIC_URL+"/sounds/equip-01.wav"]}),explosion_0:new ge.Howl({src:[window.PUBLIC_URL+"/sounds/explosion-00.wav"],volume:.2}),save:new ge.Howl({src:[window.PUBLIC_URL+"/sounds/save.wav"]}),lose:new ge.Howl({src:[window.PUBLIC_URL+"/sounds/lose-00.wav"]}),grab_0:new ge.Howl({src:[window.PUBLIC_URL+"/sounds/grab-00.wav"]}),release_0:new ge.Howl({src:[window.PUBLIC_URL+"/sounds/grab-01.wav"]})},me=function(){function e(t){var a=t.game,n=t.actor,r=t.energyCost,i=void 0===r?100:r,s=t.processDelay,o=void 0===s?50:s,u=t.particles,l=void 0===u?[]:u,h=t.particleTemplate,p=void 0===h?re.default:h,d=t.onBefore,f=void 0===d?function(){return null}:d,g=t.onAfter,y=void 0===g?function(){return null}:g,m=t.onSuccess,b=void 0===m?function(){return null}:m,v=t.onFailure,O=void 0===v?function(){return null}:v,j=t.interrupt,k=void 0!==j&&j;Object(c.a)(this,e),this.actor=n,this.game=a,this.energyCost=i,this.processDelay=o,this.particles=l,this.particleTemplate=p,this.onBefore=f,this.onAfter=y,this.onSuccess=b,this.onFailure=O,this.interrupt=k}return Object(o.a)(e,[{key:"addParticle",value:function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Object(p.a)({},this.particleTemplate.renderer),r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:ie,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=new tt({game:this.game,name:"particle",passable:!0,life:e,pos:t,direction:a,energy:100,renderer:n,type:r,path:i});this.particles.push(s)}},{key:"removeDeadParticles",value:function(){this.particles=this.particles.filter((function(e){return e.life>0}))}},{key:"perform",value:function(){return console.log("".concat(this.actor.name," performs")),this.actor.energy-=this.energyCost,{success:!0,alternative:null}}}]),e}(),be=function(e){function t(e){var a,n=e.message,r=e.messageType,i=void 0===r?ue.INFORMATION:r,s=e.processDelay,o=void 0===s?50:s,h=Object(L.a)(e,["message","messageType","processDelay"]);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},h)))).message=n,a.messageType=i,a.processDelay=o,a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"perform",value:function(){return this.game.addMessage("".concat(this.actor.name,' says "').concat(this.message,'"'),this.messageType),this.actor.energy-=this.energyCost,{success:!0,alternative:null}}}]),t}(me),ve=function(e){function t(e){var a,n=e.targetPos,r=e.radius,i=void 0===r?1:r,s=Object(L.a)(e,["targetPos","radius"]);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},s)))).targetPos=n,a.radius=i,a.particleTemplate=re.water,a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"perform",value:function(){var e=this;if(!this.actor.hasItemNameEquipped(pe))return this.game.addMessage("".concat(this.actor.name," doesn't have a ").concat(pe,"."),ue.ERROR),{success:!1,alternative:null};var t={x_offset:0,y_offset:0,positions:Array(this.radius).fill("").reduce((function(e,t,a){return e.concat.apply(e,Object(v.a)(D(0,0,a+1)))}),[])},a=t.positions.map((function(a){return{x:e.targetPos.x+a.x+t.x_offset,y:e.targetPos.y+a.y+t.y_offset}})).concat(Object(p.a)({},this.targetPos));return a.forEach((function(t){var a=e.game.map[C(t)];a&&("BURNT"===a.type&&(a.type="GROUND"),"FLOOR"===a.type&&(a.type="WET"))})),a.forEach((function(t){e.addParticle(3,Object(p.a)({},t),{x:Math.sign(t.x-e.targetPos.x),y:Math.sign(t.y-e.targetPos.y)})})),E([ye.water_0,ye.water_1]).play(),this.actor.energy-=this.energyCost,{success:!0,alternative:null}}}]),t}(me),Oe=function(e){function t(e){var a,n=e.item,r=Object(L.a)(e,["item"]);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},r)))).item=n,a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"perform",value:function(){var e=this,t=!1;if(this.item.equipmentType)if(this.actor.getItemInSlot(this.item.equipmentType))this.game.addMessage("".concat(this.actor.name,"'s equipment slots are full."),ue.ERROR);else{this.actor.equip(this.item.equipmentType,this.item);var a=this.game.map[C(this.actor.pos)].entities;this.game.map[C(this.actor.pos)].entities=a.filter((function(t){return t.id!==e.item.id})),this.game.addMessage("".concat(this.actor.name," equips ").concat(this.item.name,"."),ue.ACTION),t=!0,this.actor.energy-=this.energyCost}return{success:t,alternative:null}}}]),t}(me),je=function(e){function t(e){var a,n=e.item,r=Object(L.a)(e,["item"]);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},r)))).item=n,a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"perform",value:function(){return this.game.addMessage("".concat(this.actor.name," drops ").concat(this.item.name,"."),ue.ACTION),this.actor.unequip(this.item),this.game.map[C(this.actor.pos)].entities.splice(0,0,this.item),this.actor.energy-=this.energyCost,{success:!0,alternative:null}}}]),t}(me),ke=function(e){function t(e){var a,n=e.processDelay,r=void 0===n?0:n,i=Object(L.a)(e,["processDelay"]);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},i)))).processDelay=r,a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"perform",value:function(){return this.actor.energy-=this.energyCost,this.actor.destroy(),{success:!0,alternative:null}}}]),t}(me),xe=function(e){function t(e){var a,n=e.targetPos,r=e.processDelay,i=void 0===r?0:r,s=Object(L.a)(e,["targetPos","processDelay"]);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},s)))).targetPos=n,a.processDelay=i,a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"perform",value:function(){var e=this,t=!1,a=this.actor.initiatedBy.pos,n=T(this.game,this.targetPos,a,8);if((!this.actor.range||n.length<=this.actor.range)&&this.game.cursorCanOccupyPosition(this.targetPos)){var r=this.game.map[C(this.actor.pos)];this.game.map[C(this.actor.pos)]=Object(p.a)({},r,{entities:r.entities.filter((function(t){return t.id!==e.actor.id}))}),this.actor.pos=this.targetPos,this.game.map[C(this.targetPos)].entities.push(this.actor),t=!0}return{success:t,alternative:null}}}]),t}(me),we=function(e){function t(e){var a,n=e.targetPos,r=e.entity,i=e.interrupt,s=void 0===i||i,o=e.forcePlacement,h=void 0!==o&&o,d=Object(L.a)(e,["targetPos","entity","interrupt","forcePlacement"]);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},d)))).targetPos=n,a.entity=r,a.interrupt=s,a.forcePlacement=h,a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"perform",value:function(){var e=!1,t=!!this.forcePlacement||this.game.canOccupyPosition(this.targetPos,this.entity),a=this.game.map[C(this.targetPos)];return t&&a&&(this.entity.pos=this.targetPos,a.entities.push(this.entity),this.game.engine.addActorAsNext(this.entity),e=!0),e&&(this.actor.energy-=this.energyCost),{success:e,alternative:null}}}]),t}(me),Ee=function(e){function t(e){var a,n=e.targetPos,r=e.processDelay,i=void 0===r?25:r,s=Object(L.a)(e,["targetPos","processDelay"]);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},s)))).targetPos=n,a.processDelay=i,a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"perform",value:function(){var e=!1,t=null;return this.actor.move(this.targetPos)?(this.actor.energy-=this.energyCost,e=!0):(e=!0,t=new Se({targetPos:this.targetPos,game:this.game,actor:this.actor,energyCost:100})),{success:e,alternative:t}}}]),t}(me),Ae=function(e){function t(e){var a,n=e.targetPos,r=e.damageToSelf,i=void 0===r?1:r,s=e.processDelay,o=void 0===s?25:s,h=Object(L.a)(e,["targetPos","damageToSelf","processDelay"]);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},h)))).targetPos=n,a.processDelay=o,a.damageToSelf=i,a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"perform",value:function(){var e=!1,t=null;return this.actor.move(this.targetPos)?(this.actor.energy-=this.energyCost,e=!0):(e=!0,t=new Ie({targetPos:this.targetPos,game:this.game,actor:this.actor,energyCost:100,damageToSelf:this.damageToSelf})),{success:e,alternative:t}}}]),t}(me),Ce=function(e){function t(e){var a,n=e.targetPos,r=e.direction,i=Object(L.a)(e,["targetPos","direction"]);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},i)))).targetPos=n,a.direction=r,a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"perform",value:function(){var e=!1,t=null;return this.actor.shove(this.targetPos,this.direction)?(this.actor.energy-=this.energyCost,e=!0):(e=!0,t=new Se({targetPos:this.targetPos,game:this.game,actor:this.actor,energyCost:100})),{success:e,alternative:t}}}]),t}(me),Te=function(e){function t(e){var a,n=e.targetPos,r=Object(L.a)(e,["targetPos"]);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},r)))).targetPos=n,a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"perform",value:function(){var e=!1;return this.actor.grab(this.targetPos)&&(this.actor.energy-=this.energyCost,e=!0,this.addParticle(2,Object(p.a)({},this.targetPos),{x:0,y:0},re.succede.renderer),ye.grab_0.play()),{success:e,alternative:null}}}]),t}(me),Pe=function(e){function t(e){var a=Object.assign({},e);return Object(c.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},a)))}return Object(h.a)(t,e),Object(o.a)(t,[{key:"perform",value:function(){var e=!1,t=this.actor.release();return t&&(this.actor.energy-=this.energyCost,this.addParticle(2,Object(p.a)({},t.pos),{x:0,y:0},re.succede.renderer),e=!0,ye.release_0.play()),{success:e,alternative:null}}}]),t}(me),Se=function(e){function t(e){var a,n=e.targetPos,r=e.processDelay,i=void 0===r?100:r,s=Object(L.a)(e,["targetPos","processDelay"]);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},s)))).targetPos=n,a.processDelay=i,a.particleTemplate=re.damage,a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"perform",value:function(){var e;if(!this.actor.entityTypes.includes("ATTACKING"))return{success:!0,alternative:new be({message:"Ooh I don't know how to attack",game:this.game,actor:this.actor})};(e=this.actor.attack(this.targetPos))&&(E([ye.chop_0,ye.chop_1]).play(),this.addParticle(1,Object(p.a)({},this.targetPos),{x:0,y:0}),this.actor.energy-=this.energyCost);return{success:e,alternative:null}}}]),t}(me),Ie=function(e){function t(e){var a,n=e.damageToSelf,r=Object(L.a)(e,["damageToSelf"]);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},r)))).damageToSelf=n,a.onSuccess=function(){console.log("Self destruct success"),a.actor.decreaseDurabilityWithoutDefense(n)},a.onFailure=function(){console.log("Self destruct fails"),a.actor.destroy()},a}return Object(h.a)(t,e),t}(Se),Re=function(e){function t(e){var a=Object.assign({},e);return Object(c.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},a)))}return Object(h.a)(t,e),Object(o.a)(t,[{key:"perform",value:function(){var e=!1,a=null;this.actor.passable=!1;var n=Object(N.a)(Object(l.a)(t.prototype),"perform",this).call(this);(n.success&&(this.actor.path.shift(),e=!0),0===this.actor.path.length&&(e=!0,a=new ke({game:this.game,actor:this.actor,energyCost:100,processDelay:0})),n.alternative)&&(this.actor.attack(this.targetPos)&&(a=new ke({game:this.game,actor:this.actor,energyCost:100,processDelay:0})));return{success:e,alternative:a}}}]),t}(Ee),De=function(e){function t(e){var a,n=Object.assign({},e);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},n)))).processDelay=0,a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"perform",value:function(){var e=!1,a=null;this.actor.passable=!1;var n=Object(N.a)(Object(l.a)(t.prototype),"perform",this).call(this);return n.success&&(this.actor.path.shift(),e=!0),0===this.actor.path.length&&(e=!0,a=new ke({game:this.game,actor:this.actor,energyCost:100,processDelay:0})),n.alternative&&this.actor.attack(this.targetPos),{success:e,alternative:a}}}]),t}(Ee),Ne=function(e){function t(e){var a,n=e.engine,r=Object(L.a)(e,["engine"]);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},r)))).engine=n,a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"perform",value:function(){var e=Object(k.a)(j.a.mark((function e(){var t,a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=!0,a=null,console.log("".concat(this.actor.name," is cranking its engine.")),e.prev=3,e.next=6,this.engine.start();case 6:this.actor.energy-=this.energyCost,e.next=14;break;case 9:e.prev=9,e.t0=e.catch(3),console.log("CrankEngine"),console.log(e.t0),a=new ke({game:this.game,actor:this.actor,energyCost:100});case 14:return e.abrupt("return",{success:t,alternative:a});case 15:case"end":return e.stop()}}),e,this,[[3,9]])})));return function(){return e.apply(this,arguments)}}()}]),t}(me),Le=function e(t){var a=t.game,n=void 0===a?null:a,r=t.passable,i=void 0!==r&&r,s=t.name,o=void 0===s?"nameless":s;Object(c.a)(this,e);var u=_()();this.entityTypes=["Entity"],this.id=u,this.name=o,this.game=n,this.passable=i,this.active=!0},Me=function(e){return function(e){function t(e){var a,n=e.children,r=void 0===n?[]:n,i=e.engine,s=void 0===i?new pt({}):i,o=Object(L.a)(e,["children","engine"]);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},o)))).entityTypes=a.entityTypes.concat("PARENT"),a.children=r,a.engine=s,a.isInitialized=!1,a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"destroyChild",value:function(e){e.energy=0;var t=this.game.map[C(e.pos)];this.game.map[C(e.pos)].entities=t.entities.filter((function(t){return t.id!==e.id})),this.engine.actors=this.engine.actors.filter((function(t){return t.id!==e.id})),this.game.draw()}},{key:"canAttack",value:function(e){return!this.children.map((function(e){return e.id})).includes(e.id)}},{key:"initialize",value:function(){var e=this;this.isInitialized=!0,this.engine.game=this.game,this.engine.actors=this.children,this.engine.actors.forEach((function(t){t.game=e.game,t.destroy=function(){e.destroyChild(t)},t.canAttack=e.canAttack.bind(e),e.game.placeActorOnMap(t),e.engine.addActor(t),e.game.draw()}))}},{key:"getAction",value:function(e){return this.isInitialized||this.initialize(),new Ne({game:e,actor:this,engine:this.engine,energyCost:100,processDelay:10})}}]),t}(e)},_e=function(e){return function(e){function t(e){var a,n=e.attackDamage,r=void 0===n?1:n,i=Object(L.a)(e,["attackDamage"]);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},i)))).entityTypes=a.entityTypes.concat("ATTACKING"),a.attackDamage=r,a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"getAttackDamage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.attackDamage+e}},{key:"canAttack",value:function(e){return!0}},{key:"attack",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=!1,n=this.game.map[C(e)];if(!n)return a;var r=I(n.entities);if(r.length>0){var i=r[0];if(this.canAttack(i)){var s=this.getAttackDamage(t);this.entityTypes.includes("EQUIPING")&&this.equipment.forEach((function(e){e.item&&e.item.entityTypes.includes("ATTACKING")&&(s+=e.item.getAttackDamage())})),this.game.addMessage("".concat(this.name," does ").concat(s," to ").concat(i.name),ue.DANGER),i.decreaseDurability(s),a=!0}}return a}}]),t}(e)},Be=function(e){return function(e){function t(e){var a,n=e.name,r=void 0===n?"nameless":n,i=e.equipmentType,s=void 0===i?Z:i,o=Object(L.a)(e,["name","equipmentType"]);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},o)))).entityTypes=a.entityTypes.concat("EQUIPABLE"),a.name=r,a.equipmentType=s,a}return Object(h.a)(t,e),t}(e)},Ge=function(e){return function(e){function t(e){var a,n=e.actions,r=void 0===n?[]:n,i=e.speed,s=void 0===i?100:i,o=(e.energy,Object(L.a)(e,["actions","speed","energy"]));return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},o)))).entityTypes=a.entityTypes.concat("ACTING"),a.actions=r,a.speed=s,a.energy=s,a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"getAction",value:function(){var e=E(this.actions);if(e)return e}},{key:"gainEnergy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.speed;this.energy+=e}},{key:"hasEnoughEnergy",value:function(){return this.energy>0}}]),t}(e)},Ue=function(e){return function(e){function t(e){var a,n=e.pos,r=void 0===n?{x:0,y:0}:n,i=e.renderer,s=Object(L.a)(e,["pos","renderer"]);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},s)))).entityTypes=a.entityTypes.concat("RENDERING"),a.pos=r,a.renderer=Object(p.a)({},i),a.currentFrame=0,a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"getPosition",value:function(){return this.pos}},{key:"move",value:function(e){var t=this,a=!1;if(this.game.canOccupyPosition(e,this)){var n=this.game.map[C(this.pos)];this.game.map[C(this.pos)]=Object(p.a)({},n,{entities:n.entities.filter((function(e){return e.id!==t.id}))}),this.pos=e,this.game.map[C(e)].entities.push(this),a=!0}return a}},{key:"shove",value:function(e,t){var a=this.game.map[C(e)];return a&&a.entities.map((function(e){if(!e.passable){var a={x:e.pos.x+t[0],y:e.pos.y+t[1]};e.move(a)}})),this.move(e)}}]),t}(e)},Fe=function e(t){var a=t.itemType,n=t.items;Object(c.a)(this,e),this.itemType=a,this.items=n},We=function(e){return function(e){function t(e){var a,n=e.container,r=void 0===n?[]:n,i=Object(L.a)(e,["container"]);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},i)))).entityTypes=a.entityTypes.concat("CONTAINING"),a.container=r,a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"createSlot",value:function(e){var t=new Fe({itemType:e.name,items:[e]});this.container.push(t)}},{key:"contains",value:function(e){var t=this.container.filter((function(t){return t.itemType===e}));return t.length>0&&t[0].items[0]}},{key:"addToContainer",value:function(e){var t=this.container.findIndex((function(t){return t.itemType===e.name}));t>=0?this.container[t].items.push(e):this.createSlot(e)}},{key:"removeFromContainer",value:function(e){var t=this;this.container.forEach((function(a,n){a.items=a.items.filter((function(t){return t.id!==e.id})),a.items.length||t.container.splice(n,1)}))}}]),t}(e)},He=function(e){return function(e){function t(e){var a,n=e.keymap,r=void 0===n?{}:n,i=Object(L.a)(e,["keymap"]);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},i)))).entityTypes=a.entityTypes.concat("PLAYING"),a.nextAction=null,a.keymap=r,a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"setNextAction",value:function(e){this.nextAction=e}},{key:"getAction",value:function(){var e=this.nextAction;return this.nextAction=null,e}}]),t}(e)},qe=function(e){return function(e){function t(e){var a,n=e.targetEntity,r=void 0===n?null:n,i=Object(L.a)(e,["targetEntity"]);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},i)))).entityTypes=a.entityTypes.concat("CHASING"),a.targetEntity=r,a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"getAction",value:function(e){var t=T(e,this.targetEntity.pos,this.pos),a=t.length>0?t[0]:this.pos;return new Ee({targetPos:a,game:e,actor:this,energyCost:100})}}]),t}(e)},ze=function(e){return function(e){function t(e){var a,n=Object.assign({},e);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},n)))).entityTypes=a.entityTypes.concat("DRAGGABLE"),a}return Object(h.a)(t,e),t}(e)},Ke=function(e){return function(e){function t(e){var a,n=e.durability,r=void 0===n?1:n,i=e.defense,s=void 0===i?0:i,o=e.onDestroy,h=void 0===o?function(){return null}:o,d=Object(L.a)(e,["durability","defense","onDestroy"]);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},d)))).entityTypes=a.entityTypes.concat("DESTRUCTABLE"),a.durability=r,a.defense=s,a.onDestroy=h,a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"getDefense",value:function(){var e=this.defense;return this.entityTypes.includes("EQUIPING")&&this.equipment.forEach((function(t){t.item&&t.item.entityTypes.includes("DESTRUCTABLE")&&(e+=t.item.getDefense())})),e}},{key:"decreaseDurabilityWithoutDefense",value:function(e){this.durability-=e,this.durability<=0&&this.destroy()}},{key:"decreaseDurability",value:function(e){var t=this.durability,a=t-(e-this.getDefense());this.durability=Math.min(t,a),this.renderer.character=this.durability,this.game.draw(),this.durability<=0&&this.destroy()}},{key:"increaseDurability",value:function(e){this.durability+=e}},{key:"destroy",value:function(){this.onDestroy(),U(this)}}]),t}(e)},Ye=function(e){return function(e){function t(e){var a,n=Object.assign({},e);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},n)))).entityTypes=a.entityTypes.concat("BURNABLE"),a.canBurn=!0,a.willResetCanBurn=!1,a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"resetCanBurn",value:function(){this.willResetCanBurn=!1,this.canBurn=!0}},{key:"burn",value:function(){return!!this.canBurn&&(this.decreaseDurability(2),!0)}}]),t}(e)},Xe=G()(Ge,Ue,He,(function(e){return function(e){function t(e){var a,n=e.initiatedBy,r=void 0===n?null:n,i=e.range,s=void 0===i?null:i,o=Object(L.a)(e,["initiatedBy","range"]);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},o)))).entityTypes=a.entityTypes.concat("UI"),a.initiatedBy=r,a.active=!0,a.range=s,a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"hasEnoughEnergy",value:function(){return this.active}}]),t}(e)}))(Le),Ve=(G()(Ge,Ue)(Le),G()(Ge,Ue,Ke,(function(e){return function(e){function t(e){var a,n=e.messages,r=void 0===n?["I have nothing to say."]:n,i=e.messageType,s=Object(L.a)(e,["messages","messageType"]);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},s)))).entityTypes=a.entityTypes.concat("SPEAKING"),a.messages=r,a.messageType=i,a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"getAction",value:function(e){var t=this.messages.shift();return this.messages.push(t),new be({actor:this,game:e,message:t,messageType:this.messageType,processDelay:0})}}]),t}(e)}),ze,Ye,(function(e){return function(e){function t(e){var a,n=Object.assign({},e);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},n)))).entityTypes=a.entityTypes.concat("HELPLESS"),a.saved=!1,a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"save",value:function(){this.saved=!0,ye.save.play()}},{key:"destroy",value:function(){E([ye.scream_0,ye.scream_1,ye.scream_2]).play(),Object(N.a)(Object(l.a)(t.prototype),"destroy",this).call(this)}}]),t}(e)}))(Le)),Je=(G()(Ue,Ke)(Le),G()(Ue,We,ze,Ye,Ke,(function(e){return function(e){function t(e){var a,n=e.flammability,r=void 0===n?1:n,i=e.explosivity,s=void 0===i?1:i,o=Object(L.a)(e,["flammability","explosivity"]);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},o)))).entityTypes=a.entityTypes.concat("EXPLODING"),a.flammability=r,a.explosivity=s,a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"enflame",value:function(){var e=this;Array(this.flammability).fill("").map((function(t){return new et({name:"Pyro",pos:Object(p.a)({},e.pos),game:e.game,renderer:{character:"*",color:K.base3,background:K.red},timeToSpread:1,spreadCount:1,durability:1,attackDamage:1,speed:100})})).forEach((function(t){e.game.placeActorOnMap(t),e.game.engine.addActor(t)}))}},{key:"explode",value:function(){var e=this,t={x_offset:0,y_offset:0,positions:Array(this.explosivity).fill("").reduce((function(e,t,a){return e.concat.apply(e,Object(v.a)(D(0,0,a+1)))}),[])};t.positions.forEach((function(a){var n={x:e.pos.x+a.x+t.x_offset,y:e.pos.y+a.y+t.y_offset},r=e.game.map[C(n)];r&&(r.type="BURNT")})),this.explosivity>0&&ye.explosion_0.play()}},{key:"destroy",value:function(){this.enflame(),this.explode(),Object(N.a)(Object(l.a)(t.prototype),"destroy",this).call(this)}}]),t}(e)}))(Le)),Qe=(G()(Ge,Ue,(function(e){return function(e){function t(e){var a,n=e.path,r=void 0!==n&&n,i=e.direction,s=void 0===i?{x:0,y:0}:i,o=e.range,h=void 0===o?3:o,d=Object(L.a)(e,["path","direction","range"]);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},d)))).entityTypes=a.entityTypes.concat("DIRECTIONAL_PUSHING"),a.path=r,a.direction=s,a.range=h,a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"getAction",value:function(e){var t=this,a={x:this.pos.x+this.direction[0],y:this.pos.y+this.direction[1]};return this.passable=!1,this.range>0?new Ce({targetPos:a,direction:this.direction,game:e,actor:this,energyCost:100,onSuccess:function(){return t.range-=1}}):new ke({game:e,actor:this,energyCost:0})}}]),t}(e)}),Ke)(Le),G()(Ge,Ue,qe,Ke)(Le),G()(Ge,Ue,qe,Ke,_e)(Le),G()(Ge,Ue,(function(e){return function(e){function t(e){var a,n=e.targetEntity,r=void 0===n?null:n,i=e.getProjectile,s=void 0===i?function(){return null}:i,o=Object(L.a)(e,["targetEntity","getProjectile"]);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},o)))).entityTypes=a.entityTypes.concat("RANGED_CHASING"),a.targetEntity=r,a.getProjectile=s,a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"targetInPath",value:function(e,t){var a=!1;return e.forEach((function(e){e.x===t.x&&e.y===t.y&&(a=!0)})),a}},{key:"getAction",value:function(e){var t={x:Math.sign(this.targetEntity.pos.x-this.pos.x),y:Math.sign(this.targetEntity.pos.y-this.pos.y)},a=this.getProjectile({pos:{x:this.pos.x,y:this.pos.y},targetPos:Object(p.a)({},this.targetEntity.pos),direction:[t.x,t.y],range:10});if(a.createPath(e),this.targetInPath(a.path,this.targetEntity.pos))return e.canOccupyPosition(a.pos,a)?new we({targetPos:Object(p.a)({},a.pos),entity:a,game:e,actor:this,energyCost:100}):new be({message:"I'll get you with this kunai!",game:e,actor:this,energyCost:100});var n=T(e,this.targetEntity.pos,this.pos),r=n.length>0?n[0]:this.pos;return new Ee({targetPos:r,game:e,actor:this,energyCost:100})}}]),t}(e)}),Ke,_e)(Le),G()(Ge,Ue,(function(e){return function(e){function t(e){var a,n=e.draggedEntity,r=void 0===n?null:n,i=Object(L.a)(e,["draggedEntity"]);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},i)))).entityTypes=a.entityTypes.concat("DRAGGING"),a.draggedEntity=r,a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"grab",value:function(e){var t=this.game.map[C(e)];if(!t)return!1;if(t.entities.length>0){var a=t.entities[0];if(!this.draggedEntity&&a.entityTypes.includes("DRAGGABLE"))return this.draggedEntity=a,!0}return!1}},{key:"release",value:function(){if(!this.draggedEntity)return!1;var e=Object(p.a)({},this.draggedEntity);return this.draggedEntity=null,e}},{key:"drag",value:function(e){var t=this,a=this.draggedEntity.pos,n=this.game.map[C(a)];this.game.map[C(a)]=Object(p.a)({},n,{entities:n.entities.filter((function(e){return e.id!==t.draggedEntity.id}))}),this.draggedEntity.pos=e,this.game.map[C(e)].entities.push(this.draggedEntity)}},{key:"move",value:function(e){var a=Object(p.a)({},this.pos);if(this.draggedEntity){var n=Object(N.a)(Object(l.a)(t.prototype),"move",this).call(this,e);return n?(this.drag(a),!0):n}return Object(N.a)(Object(l.a)(t.prototype),"move",this).call(this,e)}}]),t}(e)}),(function(e){return function(e){function t(e){var a,n=e.charge,r=void 0===n?10:n,i=Object(L.a)(e,["charge"]);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},i)))).entityTypes=a.entityTypes.concat("CHARGING"),a.charge=r,a.chargeMax=r,a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"decreaseCharge",value:function(e){this.charge=Math.max(0,this.charge-e)}},{key:"increaseCharge",value:function(e){this.charge=Math.min(this.chargeMax,this.charge+e)}}]),t}(e)}),(function(e){return function(e){function t(e){var a,n=Object.assign({},e);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},n)))).entityTypes=a.entityTypes.concat("SIGNING"),a.signHistory=[],a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"addSign",value:function(e){this.signHistory.length>=4&&this.signHistory.shift(),this.signHistory.push(e)}},{key:"clearSigns",value:function(){this.signHistory=[]}}]),t}(e)}),We,(function(e){return function(e){function t(e){var a,n=e.equipment,r=void 0===n?te():n,i=Object(L.a)(e,["equipment"]);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},i)))).entityTypes=a.entityTypes.concat("EQUIPING"),a.equipment=r,a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"hasItemNameEquipped",value:function(e){return this.equipment.filter((function(t){return!(!t.item||t.item.name!==e)})).length>0}},{key:"getItemInSlot",value:function(e){if(this.equipment.filter((function(t){return null===t.item&&t.type===e})).length>0)return!1;var t=this.equipment.find((function(t){return t.type===e}));return!!t&&(!!t.item&&t.item)}},{key:"equip",value:function(e,t){var a=!1;return this.equipment=this.equipment.map((function(n){return a||n.type!==e||null!==n.item||(n.item=t,a=!0,ye.equip_1.play()),n})),a}},{key:"unequip",value:function(e){this.equipment=this.equipment.map((function(t){return t.item&&t.item.id===e.id&&(t.item=null,ye.equip_0.play()),t}))}}]),t}(e)}),_e,(function(e){return function(e){function t(e){var a,n=e.currentGate,r=void 0===n?null:n,i=(e.gates,Object(L.a)(e,["currentGate","gates"]));return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},i)))).entityTypes=a.entityTypes.concat("HAS_INNER_GATES"),a.currentGate=r,a.gates=[{name:"Gate of Opening",damageBuff:1,speedBuff:100,durabilityDebuff:1,character:"1"},{name:"Gate of Healing",damageBuff:1,speedBuff:100,durabilityDebuff:1,character:"2"},{name:"Gate of Life",damageBuff:1,speedBuff:100,durabilityDebuff:1,character:"3"},{name:"Gate of Pain",damageBuff:1,speedBuff:100,durabilityDebuff:1,character:"4"},{name:"Gate of Limit",damageBuff:1,speedBuff:100,durabilityDebuff:1,character:"5"}],a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"setNextGate",value:function(){var e=this.currentGate,t=null;if(e){var a=this.gates.findIndex((function(t){return e.name===t.name}))+1;this.gates.length>a&&(t=this.gates[a],this.currentGate=Object(p.a)({},t))}else t=this.gates[0],this.currentGate=Object(p.a)({},t);return t}},{key:"getNextGate",value:function(){var e=this.currentGate,t=null;if(e){var a=this.gates.findIndex((function(t){return e.name===t.name}))+1;this.gates.length>a&&(t=this.gates[a])}else t=this.gates[0];return t}}]),t}(e)}),Ke,(function(e){return function(e){function t(e){var a,n=e.cloneLimit,r=void 0===n?1:n,i=Object(L.a)(e,["cloneLimit"]);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},i)))).entityTypes=a.entityTypes.concat("CLONING"),a.cloneLimit=r,a.clones=[],a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"destroy",value:function(){this.clones&&this.clones.map((function(e){U(e)})),U(this)}},{key:"destroyClone",value:function(e){var t=this.clones.findIndex((function(t){return t.id==e}));t>=0&&(this.clones[t].super__destroy(),this.clones.splice(t,1))}},{key:"createClone",value:function(e){var t=this;if(this.clones.length<this.cloneLimit){var a=Object(oe.cloneDeep)(this);if(a.name="Clone",a.game=this.game,a.id=_()(),delete a.clones,a.super__destroy=a.destroy,a.destroy=function(){t.destroyClone(a.id)},e.forEach((function(e){a[e.attribute]=e.value})),this.game.placeActorOnMap(a))return this.game.engine.addActorAsNext(a),this.game.draw(),this.clones.push(a),!0}return!1}}]),t}(e)}),He,Ye)(Le)),Ze=G()(Ue,Be,_e)(Le),$e=G()(Ue,Be,Ke)(Le),et=(G()(Ge,Ue,_e,(function(e){return function(e){function t(e){var a,n=e.path,r=void 0!==n&&n,i=e.targetPos,s=void 0===i?null:i,o=e.attackDamage,h=void 0===o?1:o,d=e.range,f=void 0===d?3:d,g=Object(L.a)(e,["path","targetPos","attackDamage","range"]);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},g)))).entityTypes=a.entityTypes.concat("DESTRUCTIVE_PROJECTING"),a.path=r,a.targetPos=s,a.attackDamage=h,a.range=f,a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"createPath",value:function(e){var t=P(e,this.targetPos,this.pos,8,this.range);this.path=t}},{key:"getAction",value:function(e){this.path||this.createPath(e);var t=this.path.length>0?this.path[0]:this.pos;return new Re({targetPos:t,game:e,actor:this,energyCost:100})}}]),t}(e)}),Ke)(Le),G()(Ge,Ue,_e,(function(e){return function(e){function t(e){var a,n=e.path,r=void 0!==n&&n,i=e.direction,s=void 0===i?{x:0,y:0}:i,o=e.attackDamage,h=void 0===o?1:o,d=e.range,f=void 0===d?3:d,g=Object(L.a)(e,["path","direction","attackDamage","range"]);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},g)))).entityTypes=a.entityTypes.concat("DIRECTIONAL_PROJECTING"),a.path=r,a.direction=s,a.attackDamage=h,a.range=f,a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"createPath",value:function(e){for(var t=[],a=1;a<this.range+1;a++)t.push({x:this.pos.x+this.direction[0]*a,y:this.pos.y+this.direction[1]*a});this.path=t}},{key:"getAction",value:function(e){var t=this,a={x:this.pos.x+this.direction[0],y:this.pos.y+this.direction[1]};return this.passable=!1,this.range>0?new Ae({targetPos:a,game:e,actor:this,energyCost:100,damageToSelf:1,onSuccess:function(){return t.range-=1},onAfter:function(){t.energy<=100&&e.engine.setActorToPrevious()}}):new ke({game:e,actor:this,energyCost:0})}}]),t}(e)}),Ke)(Le),G()(Ge,Ue,_e,(function(e){return function(e){function t(e){var a,n=e.owner_id,r=void 0===n?null:n,i=e.path,s=void 0!==i&&i,o=e.targetPos,h=void 0===o?null:o,d=e.attackDamage,f=void 0===d?1:d,g=e.range,y=void 0===g?3:g,m=Object(L.a)(e,["owner_id","path","targetPos","attackDamage","range"]);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},m)))).entityTypes=a.entityTypes.concat("GASEOUS_DESTRUCTIVE_PROJECTING"),a.path=s,a.targetPos=h,a.attackDamage=f,a.range=y,a.owner_id=r,a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"canAttack",value:function(e){var a=Object(N.a)(Object(l.a)(t.prototype),"canAttack",this).call(this);return a&&(a=null===this.owner_id||e.owner_id!==this.owner_id),a}},{key:"createPath",value:function(e){var t=P(e,this.targetPos,this.pos,8,this.range);this.path=t}},{key:"getAction",value:function(e){this.path||this.createPath(e);var t=this.path.length>0?this.path[0]:this.pos;return new De({targetPos:t,game:e,actor:this,energyCost:100})}}]),t}(e)}),Ke,(function(e){return function(e){function t(e){var a,n=e.isClone,r=void 0!==n&&n,i=e.cloneCount,s=void 0===i?0:i,o=e.clonePattern,h=void 0===o?ne.square:o,d=Object(L.a)(e,["isClone","cloneCount","clonePattern"]);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},d)))).entityTypes=a.entityTypes.concat("GASEOUS"),a.isClone=r,a.cloneCount=s,a.clonePattern=Object(oe.cloneDeep)(h),a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"getAction",value:function(e){var a=this.clonePattern.positions.find((function(e){return!e.taken}));if(!this.isClone&&a){a.taken=!0;var n=Object(oe.cloneDeepWith)(this,(function(e,t){switch(t){case"id":case"game":case"engine":case"clones":return null;default:return}}));if(n.game=e,n.id=_()(),this.hasOwnProperty("pos")){var r=this.pos;n.pos={x:r.x+a.x,y:r.y+a.y}}n.hasOwnProperty("path")&&(n.path=n.path.map((function(e){return{x:e.x+a.x,y:e.y+a.y}}))),n.isClone=!0,this.cloneCount+=1,e.placeActorOnMap(n),e.engine.addActor(n),e.draw()}return Object(N.a)(Object(l.a)(t.prototype),"getAction",this).call(this,e)}}]),t}(e)}))(Le),G()(Ge,Ke,Me)(Le),G()(Ge,Ue,Ke,_e,(function(e){return function(e){function t(e){var a,n=e.timeToSpread,r=void 0===n?5:n,i=e.spreadCount,s=void 0===i?1:i,o=Object(L.a)(e,["timeToSpread","spreadCount"]);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},o)))).entityTypes=a.entityTypes.concat("SPREADING"),a.timeToSpreadMax=r,a.timeToSpread=r,a.spreadCountMax=s,a.spreadCount=s,a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"getAction",value:function(e){var t=this;if(this.spreadCount<=0)return new ke({game:e,actor:this,energyCost:100,processDelay:0,onAfter:function(){e.map[C(t.pos)].type="BURNT"}});if(this.timeToSpread<=0){for(var a=[{x:this.pos.x+1,y:this.pos.y+0},{x:this.pos.x+-1,y:this.pos.y+0},{x:this.pos.x+0,y:this.pos.y+1},{x:this.pos.x+0,y:this.pos.y+-1}],n=null,r=100;r>0;){var i=E(a),s=this.game.map[C(i)],c=Boolean(s),o=!0,u=!1;if(s&&(o="BURNT"!==s.type,u=["WALL","FLOOR","DOOR"].includes(s.type)),c&&o&&u){n=i;break}r-=1}if(n){var l=new et({name:"Pyro",pos:{x:0,y:0},game:e,renderer:{character:"*",sprite:"\ue8bb",color:K.base3,background:K.red},timeToSpread:this.timeToSpreadMax,spreadCount:this.spreadCountMax,durability:this.durability,attackDamage:this.attackDamage,speed:this.speed});return this.timeToSpread=this.timeToSpreadMax,this.spreadCount-=1,new we({targetPos:n,entity:l,game:e,actor:this,interrupt:!1,energyCost:100,processDelay:0,forcePlacement:!0})}this.timeToSpread=this.timeToSpreadMax,this.spreadCount-=1}return this.timeToSpread-=1,new be({message:"burning",game:e,actor:this,processDelay:0})}}]),t}(e)}))(Le)),tt=G()(Ge,Ue,(function(e){return function(e){function t(e){var a,n=e.pos,r=void 0===n?{x:1,y:1}:n,i=e.direction,s=void 0===i?{x:0,y:0}:i,o=e.life,h=void 0===o?1:o,d=e.speed,f=void 0===d?1:d,g=e.type,y=void 0===g?ie:g,m=e.path,b=void 0===m?null:m,v=Object(L.a)(e,["pos","direction","life","speed","type","path"]);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},v)))).pos=r,a.direction=s,a.life=h,a.speed=f,a.type=y,a.path=b,a.entityTypes=a.entityTypes.concat("PARTICLE"),a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"getNextPos",value:function(e){switch(this.type){case ie:return{x:this.pos.x+this.direction.x*this.speed*e,y:this.pos.y+this.direction.y*this.speed*e};case se:var t=this.path.shift();return t?Object(p.a)({},t):Object(p.a)({},this.pos)}}},{key:"update",value:function(e){this.life-=e,this.life>0&&(this.pos=this.getNextPos(e))}}]),t}(e)}))(Le),at=(G()(Ge,Ke,Me)(Le),function(e,t){var a=ce.filter((function(t){return!Object.keys(e).includes(t)}));e[a[0]]=t}),nt=function(e,t){var a=e.actors[e.currentActor];e.game.removeActor(a),e.game[t]=null},rt=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"move",n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return{w:{activate:function(){return e(X.N,t)},label:"".concat(a," N"),hidden:n},d:{activate:function(){return e(X.E,t)},label:"".concat(a," E"),hidden:n},s:{activate:function(){return e(X.S,t)},label:"".concat(a," S"),hidden:n},a:{activate:function(){return e(X.W,t)},label:"".concat(a," W"),hidden:n}}},it=function(e){var t=e.actors[e.currentActor];e.game.visibleEquipment=t.equipment;var a=new Xe({initiatedBy:t,pos:Object(p.a)({},t.pos),renderer:{character:"E",color:"white",background:""},name:"Equipment",game:e.game});e.addActorAsPrevious(a),e.game.placeActorOnMap(a),e.game.draw(),a.keymap=function(e,t){var a={Escape:{activate:function(){return nt(e,"visibleEquipment")},label:"Close"}};return t.equipment.filter((function(e){return e.item})).map((function(n){var r={activate:null,label:""};return r.activate=function(){t.setNextAction(new je({item:n.item,game:e.game,actor:t})),nt(e,"visibleEquipment")},r.label="Unequip ".concat(n.item.name),at(a,r),!0})),a}(e,t)},st=function(e,t){var a=t.actors[t.currentActor],n=a.pos.x+e[0],r=a.pos.y+e[1];a.setNextAction(new xe({targetPos:{x:n,y:r},game:t.game,actor:a,energyCost:0}))},ct=function(e,t,a,n){var r=function(){var a=e.actors[e.currentActor];a.active=!1,e.game.removeActor(a),t.willResetCanBurn=!0};return Object(p.a)({Escape:{activate:r,label:"Close"}},rt(st,e),{t:{activate:function(){t.canBurn=!0,function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=e.actors[e.currentActor];t.setNextAction(new ve({targetPos:Object(p.a)({},n.pos),radius:a,game:e.game,actor:t,energyCost:100}))}(e,t,n),r()},label:"activate"}})},ot=function(e,t){var a=t.actors[t.currentActor],n=a.pos.x+e[0],r=a.pos.y+e[1];a.setNextAction(new Ce({targetPos:{x:n,y:r},game:t.game,actor:a,direction:e,energyCost:100,processDelay:25}))},ut=function(e){var t=e.actors[e.currentActor],a=[];[X.N,X.E,X.S,X.W].forEach((function(n){var r={x:t.pos.x+n[0],y:t.pos.y+n[1]},i=e.game.display.addAnimation(1,{x:r.x,y:r.y,color:K.base3});a.push(i)})),t.keymap=function(e,t,a,n){var r=e.actors[e.currentActor],i=function(){t.keymap=a,n.length&&n.forEach((function(t){return e.game.display.removeAnimation(t.id)}))};return{Escape:{activate:i,label:"Cancel Chop"},w:{activate:function(){var t={x:r.pos.x+X.N[0],y:r.pos.y+X.N[1]};r.setNextAction(new Se({targetPos:t,game:e.game,actor:r})),i()},label:"activate N"},d:{activate:function(){var t={x:r.pos.x+X.E[0],y:r.pos.y+X.E[1]};r.setNextAction(new Se({targetPos:t,game:e.game,actor:r})),i()},label:"activate E"},s:{activate:function(){var t={x:r.pos.x+X.S[0],y:r.pos.y+X.S[1]};r.setNextAction(new Se({targetPos:t,game:e.game,actor:r})),i()},label:"activate S"},a:{activate:function(){var t={x:r.pos.x+X.W[0],y:r.pos.y+X.W[1]};r.setNextAction(new Se({targetPos:t,game:e.game,actor:r})),i()},label:"activate W"}}}(e,t,Object(p.a)({},t.keymap),a)},lt=function(e,t,a,n){return Object(p.a)({},rt((function(e,r){!function(e,t,a,n){var r={x:a.pos.x+e[0],y:a.pos.y+e[1]};a.setNextAction(new Te({targetPos:r,game:t.game,actor:a,energyCost:100}))}(e,r,t),t.keymap=a,n.length&&n.forEach((function(e){return r.game.display.removeAnimation(e.id)}))}),e,"grab"))},ht=function(){function e(t){var a=t.statusEffects,n=void 0===a?[]:a,r=t.actors,i=void 0===r?[]:r,s=t.currentActor,o=void 0===s?0:s,u=t.isRunning,l=void 0!==u&&u,h=t.game,p=void 0===h?null:h;Object(c.a)(this,e),this.statusEffects=n,this.actors=i,this.currentActor=o,this.isRunning=l,this.game=p}return Object(o.a)(e,[{key:"processV1",value:function(){var e=Object(k.a)(j.a.mark((function e(){var t,a,n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=this.actors[this.currentActor]).gainEnergy(t.speed),!t.hasEnoughEnergy()){e.next=18;break}if(a=t.getAction(this.game)){e.next=6;break}return e.abrupt("return",!1);case 6:return n=a.perform(),this.game.draw(),e.next=11,w(a.processDelay);case 11:if(n.success){e.next=13;break}return e.abrupt("return",!1);case 13:if(null!==n.alternative){e.next=15;break}return e.abrupt("break",18);case 15:a=n.alternative,e.next=6;break;case 18:return this.currentActor=(this.currentActor+1)%this.actors.length,e.abrupt("return",!0);case 20:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"processV2",value:function(){var e=Object(k.a)(j.a.mark((function e(){var t,a,n,r,i;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.actors[this.currentActor],a=!0;case 2:if(!a){e.next=50;break}if(t){e.next=5;break}return e.abrupt("return",!1);case 5:if(t.active){e.next=7;break}return e.abrupt("break",50);case 7:if(n=0,!t.hasEnoughEnergy()){e.next=46;break}if(r=t.getAction(this.game)){e.next=12;break}return e.abrupt("return",!1);case 12:n+=r.energyCost;case 13:return r.onBefore(),e.next=17,r.perform();case 17:return(i=e.sent).success?r.onSuccess():r.onFailure(),r.onAfter(),e.next=22,this.processActionFX(r,i.success);case 22:if(e.sent){e.next=31;break}if(!this.shouldAutoRun()){e.next=28;break}return e.next=26,w(25);case 26:e.next=30;break;case 28:return e.next=30,w(r.processDelay);case 30:this.game.draw();case 31:if(t.active){e.next=33;break}return e.abrupt("break",40);case 33:if(i.success){e.next=35;break}return e.abrupt("return",!1);case 35:if(null!==i.alternative){e.next=37;break}return e.abrupt("break",40);case 37:r=i.alternative,e.next=13;break;case 40:if(this.processStatusEffects(n),!r.interrupt){e.next=44;break}return a=!1,e.abrupt("break",50);case 44:e.next=48;break;case 46:t.gainEnergy(t.speed),a=!1;case 48:e.next=2;break;case 50:return this.actors=this.actors.filter((function(e){return e.active})),this.currentActor+=1,this.currentActor>=this.actors.length&&(this.currentActor=0),e.abrupt("return",!0);case 54:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"processV3",value:function(){var e=Object(k.a)(j.a.mark((function e(){var t,a,n,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.actors[this.currentActor]){e.next=3;break}return e.abrupt("return",!1);case 3:if(a=0,!t.hasEnoughEnergy()){e.next=29;break}if(n=t.getAction(this.game)){e.next=8;break}return e.abrupt("return",!1);case 8:a+=n.energyCost;case 9:return e.next=12,n.perform();case 12:return r=e.sent,e.next=15,this.processActionFX(n,r.success);case 15:if(e.sent){e.next=19;break}return e.next=18,w(n.processDelay);case 18:this.game.draw();case 19:if(r.success){e.next=21;break}return e.abrupt("return",!1);case 21:if(null!==r.alternative){e.next=23;break}return e.abrupt("break",26);case 23:n=r.alternative,e.next=9;break;case 26:this.processStatusEffects(a),e.next=30;break;case 29:t.gainEnergy(t.speed);case 30:return this.currentActor=(this.currentActor+1)%this.actors.length,0===this.currentActor&&this.sortActorsByEnergy(),e.abrupt("return",!0);case 33:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"start",value:function(){var e=Object(k.a)(j.a.mark((function e(){var t;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.isRunning=!0;case 1:if(!this.isRunning){e.next=7;break}return e.next=4,this.processV2();case 4:this.isRunning=e.sent,e.next=1;break;case 7:if(t=this.actors[this.currentActor]){e.next=10;break}return e.abrupt("return",!1);case 10:return t.keymap&&(this.game.visibleKeymap=t.keymap),this.game.updateMode(),e.next=14,this.game.updateReact(this.game);case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stop",value:function(){this.isRunning=!1}},{key:"sortActorsByEnergy",value:function(){this.actors=this.actors.sort((function(e,t){return t.energy-e.energy}))}},{key:"shouldAutoRun",value:function(){return!this.actors.filter((function(e){return e.entityTypes.includes("PLAYING")})).length}},{key:"addStatusEffect",value:function(e){return!e.allowDuplicates&&this.statusEffects.filter((function(t){return t.actor.id===e.actor.id&&t.name===e.name})).length>0?(console.log("".concat(e.name," cannot be applied twice to ").concat(e.actor.name)),!1):(e.onStart(),this.statusEffects.push(e),!0)}},{key:"removeStatusEffectById",value:function(e){this.statusEffects=this.statusEffects.filter((function(t){return t.id!==e||(t.onStop(),!1)}))}},{key:"removeStatusEffectByActorId",value:function(e){this.statusEffects=this.statusEffects.filter((function(t){return t.actor.id!==e||(t.onStop(),!1)}))}},{key:"removeDeadStatusEffects",value:function(){this.statusEffects=this.statusEffects.filter((function(e){return!(e.lifespan>=0&&e.timeToLive<=0)||(e.onStop(),!1)}))}},{key:"processStatusEffects",value:function(e){this.statusEffects.forEach((function(t){t.timeSinceLastStep+=e,t.timeToLive-=e,t.timeSinceLastStep>=t.stepInterval&&(t.onStep(),t.timeSinceLastStep=0)})),this.removeDeadStatusEffects()}},{key:"processActionFX",value:function(){var e=Object(k.a)(j.a.mark((function e(t,a){var n,r=this;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=11;break}return n=new tt({game:this.game,name:"particle",passable:!0,pos:Object(p.a)({},t.actor.pos),renderer:re.fail.renderer}),this.game.placeActorOnMap(n),this.game.draw(),e.next=6,w(100);case 6:return this.game.removeActorFromMap(n),n.update(1),this.game.draw(),t.removeDeadParticles(),e.abrupt("return",!0);case 11:if(!t.particles.length){e.next=23;break}case 12:if(!(t.particles.length>0)){e.next=22;break}return t.particles.forEach((function(e){r.game.placeActorOnMap(e)})),this.game.draw(),e.next=17,w(t.processDelay);case 17:t.particles.forEach((function(e){r.game.removeActorFromMap(e),e.update(1)})),this.game.draw(),t.removeDeadParticles(),e.next=12;break;case 22:return e.abrupt("return",!0);case 23:return e.abrupt("return",!1);case 24:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"addActor",value:function(e){this.actors.push(e)}},{key:"addActorAsPrevious",value:function(e){this.actors.splice(this.currentActor,0,e)}},{key:"addActorAsNext",value:function(e){this.actors.splice(this.currentActor+1,0,e)}},{key:"setActorToPrevious",value:function(e){this.currentActor-=1,this.currentActor<=-1&&(this.currentActor=this.actors.length-1)}},{key:"setActorToNext",value:function(e){this.currentActor=(this.currentActor+1)%this.actors.length}}]),e}(),pt=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(o.a)(t,[{key:"process",value:function(){var e=Object(k.a)(j.a.mark((function e(){var t,a,n,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.actors[this.currentActor],a=!0;case 2:if(!a){e.next=26;break}if(!t.hasEnoughEnergy()){e.next=23;break}if(n=t.getAction(this.game)){e.next=7;break}return e.abrupt("return",!1);case 7:return this.game.draw(),e.next=11,n.perform();case 11:return r=e.sent,e.next=14,w(n.processDelay);case 14:if(r.success){e.next=16;break}return e.abrupt("return",!1);case 16:if(null!==r.alternative){e.next=18;break}return e.abrupt("break",21);case 18:n=r.alternative,e.next=7;break;case 21:e.next=24;break;case 23:a=!1;case 24:e.next=2;break;case 26:if(this.currentActor+=1,!(this.currentActor+1>=this.actors.length)){e.next=31;break}return this.currentActor=0,this.actors.forEach((function(e){return e.gainEnergy(e.speed)})),e.abrupt("return",!1);case 31:return e.abrupt("return",!0);case 32:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"start",value:function(){var e=Object(k.a)(j.a.mark((function e(){var t;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.isRunning=!0;case 1:if(!this.isRunning){e.next=7;break}return e.next=4,this.process();case 4:this.isRunning=e.sent,e.next=1;break;case 7:return(t=this.actors[this.currentActor]).keymap&&(this.game.visibleKeymap=t.keymap),this.game.mode.update(),e.next=12,this.game.updateReact(this.game);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),t}(ht),dt=a(30),ft=a.n(dt),gt=0,yt=1,mt=2,bt=function(){function e(t){var a=t.display;Object(c.a)(this,e);var n=_()();this.id=n,this.lifeTime=0,this.active=!0,this.display=a,this.node=null}return Object(o.a)(e,[{key:"getActive",value:function(){return!1}},{key:"initialize",value:function(){}},{key:"update",value:function(e){this.lifeTime+=e.timeDiff,this.active=this.getActive(),this.active||this.display.removeAnimation(this.id)}}]),e}(),vt=function(e){function t(e){var a=Object.assign({},e);return Object(c.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},a)))}return Object(h.a)(t,e),Object(o.a)(t,[{key:"getActive",value:function(){return!(this.lifeTime>500)}}]),t}(bt),Ot=function(e){function t(e){var a,n=e.x,r=e.y,i=e.lerpDirection,s=void 0===i?-1:i,o=e.color,h=void 0===o?"#fff":o,d=Object(L.a)(e,["x","y","lerpDirection","color"]);return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},d)))).x=n,a.y=r,a.lerpDirection=s,a.color=h,a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"getActive",value:function(){return this.active}},{key:"initialize",value:function(){this.active=!0;var e=new ft.a.Rect({name:"rect",x:this.display.tileWidth*this.x+(this.display.tileOffset+this.display.tileGutter),y:this.display.tileHeight*this.y+(this.display.tileOffset+this.display.tileGutter),offsetX:this.display.tileWidth/-4,offsetY:this.display.tileHeight/-4,width:this.display.tileWidth/2,height:this.display.tileHeight/2,fill:this.color,strokeEnabled:!1,transformsEnabled:"position",perfectDrawEnabled:!1,listening:!1,shadowForStrokeEnabled:!1});this.display.animationLayer.add(e),this.node=e,Object(N.a)(Object(l.a)(t.prototype),"initialize",this).call(this)}},{key:"update",value:function(e){var a,n,r,i=this.node.opacity();i>=1&&(this.lerpDirection=-1),i<=0&&(this.lerpDirection=1),i+=.05*this.lerpDirection,this.node.opacity((a=i,n=0,r=1,Math.min(Math.max(a,n),r))),Object(N.a)(Object(l.a)(t.prototype),"update",this).call(this,e)}}]),t}(bt),jt=function(){function e(t){var a=t.containerId,n=void 0===a?null:a,r=t.width,i=void 0===r?100:r,s=t.height,o=void 0===s?100:s,u=t.tileWidth,l=void 0===u?10:u,h=t.tileHeight,p=void 0===h?10:h,d=t.tileGutter,f=void 0===d?0:d,g=t.tileOffset,y=void 0===g?10:g,m=t.cameraFollow,b=void 0!==m&&m,v=t.game,O=void 0===v?null:v;Object(c.a)(this,e),this.containerId=n,this.width=i,this.height=o,this.tilesWide=this.getTilesWide(i,y,l),this.tilesHigh=this.getTilesHigh(o,y,p),this.tileWidth=l,this.tileHeight=p,this.tileGutter=f,this.tileOffset=y,this.cameraFollow=b,this.stage=null,this.layer=null,this.animationLayer=null,this.animations=[],this.animationLoop=null,this.game=O}return Object(o.a)(e,[{key:"initialize",value:function(e){var t=this,a=e.getElementById(this.containerId),n=e.createElement("div");a.appendChild(n),this.stage=new ft.a.Stage({container:"display",width:this.width,height:this.height}),this.layer=new ft.a.Layer({hitGraphEnabled:!1}),this.stage.add(this.layer),this.animationLayer=new ft.a.Layer({}),this.stage.add(this.animationLayer);var r=new ft.a.Animation((function(e){t.animations.forEach((function(t){return t.update(e)})),t.animations.length<=0&&t.animationLoop&&t.animationLoop.isRunning()&&t.animationLoop.stop()}),this.animationLayer);this.animationLoop=r,r.start()}},{key:"addAnimation",value:function(e,t){var a;switch(e){case gt:a=new bt(Object(p.a)({display:this},t));break;case mt:a=new vt(Object(p.a)({display:this},t));break;case yt:a=new Ot(Object(p.a)({display:this},t));break;default:a=new bt(Object(p.a)({display:this},t))}return a.initialize(),this.animations.push(a),this.animationLoop.isRunning()||this.animationLoop.start(),a}},{key:"removeAnimation",value:function(e){this.animations=this.animations.filter((function(t){return t.id!==e||(t.node.destroy(),!1)}))}},{key:"updateTile",value:function(e,t,a,n){e.children[0].fill(n),e.children[1].fill(a),e.children[1].text(t)}},{key:"createTile",value:function(e,t,a,n,r){var i=new ft.a.Group({id:"".concat(e,",").concat(t),x:this.tileWidth*e+(this.tileOffset+this.tileGutter),y:this.tileHeight*t+(this.tileOffset+this.tileGutter),width:this.tileWidth,height:this.tileHeight,transformsEnabled:"position",perfectDrawEnabled:!1,listening:!1,shadowForStrokeEnabled:!1}),s=new ft.a.Rect({name:"rect",width:this.tileWidth,height:this.tileHeight,fill:r,strokeEnabled:!1,transformsEnabled:"position",perfectDrawEnabled:!1,listening:!1,shadowForStrokeEnabled:!1}),c=new ft.a.Text({name:"text",text:a,width:this.tileWidth,height:this.tileHeight,fontSize:24,fontFamily:"scroll-o-script",fill:n,align:"center",verticalAlign:"middle",transformsEnabled:"position",perfectDrawEnabled:!1,listening:!1,shadowForStrokeEnabled:!1});return i.add(s),i.add(c),this.layer.add(i),i}},{key:"getAbsoultueX",value:function(e){return this.tileWidth*e+(this.tileOffset+this.tileGutter)}},{key:"getAbsoultueY",value:function(e){return this.tileWidth*e+(this.tileOffset+this.tileGutter)}},{key:"getTilesWide",value:function(e,t,a){return Math.floor((e-t)/a)}},{key:"getTilesHigh",value:function(e,t,a){return Math.floor((e-t)/a)}},{key:"draw",value:function(e){if(this.cameraFollow&&e){var t=this.tilesWide,a=this.tilesHigh,n=Math.floor(this.width/this.tileWidth),r=Math.floor(this.height/this.tileHeight),i=Math.ceil(t-n/2),s=Math.ceil(a-r/2),c=0,o=0;e.x>t-i&&(c=t-i-e.x),e.y>a-s&&(o=a-s-e.y),this.layer.x(this.getAbsoultueX(c)),this.layer.y(this.getAbsoultueY(o))}this.layer.batchDraw()}}]),e}(),kt=function(){return[{x:0,y:0}]},xt=function(e){for(var t=E(e),a=wt(t),n=Et(a,e),r=1e3;n;)if(t=E(e.filter((function(e){return n=t,!((a=e).x===n.x&&a.y===n.y);var a,n}))),a=wt(t),n=Et(a,e),(r-=1)<=0){n=!1,a=!1;break}return a},wt=function(e){return E(Ct(e))},Et=function(e,t){return t.filter((function(t){return t.x===e.x&&t.y===e.y})).length>0},At=function(e,t,a,n){return{x:e.x+t+n*e.x,y:e.y+a+n*e.y}},Ct=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=[{x:e.x,y:e.y+1},{x:e.x+1,y:e.y},{x:e.x,y:e.y-1},{x:e.x-1,y:e.y}];return t&&(a=a.concat([{x:e.x+1,y:e.y+1},{x:e.x+1,y:e.y-1},{x:e.x-1,y:e.y-1},{x:e.x-1,y:e.y+1}])),a},Tt=function(e,t,a,n){for(var r=a+1-n,i=!1,s=0;s<r;s++)for(var c=0;c<r;c++){var o={x:t.x+s,y:t.y+c};e[C(o)]||(i=!0)}if(!i)for(var u=0;u<r;u++)for(var l=0;l<r;l++){var h={x:t.x+u,y:t.y+l},p="FLOOR";0!==u&&u!==r-1||(p="WALL"),0!==l&&l!==r-1||(p="WALL");var d=e[C(h)];d&&(d.type=p)}return!i},Pt=function(e){Object.keys(e).filter((function(t){return"WALL"===e[t].type})).filter((function(t){var a=t.split(",").map((function(e){return parseInt(e)})),n={x:a[0],y:a[1]};return 8===Ct(n,!0).filter((function(t){var a=e[C(t)];return!(!a||!["WALL","FLOOR"].includes(a.type))})).length})).forEach((function(t){e[t].type="FLOOR"}))},St=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,a=Object.keys(e).filter((function(t){if("WALL"!==e[t].type)return!1;var a=t.split(",").map((function(e){return parseInt(e)})),n={x:a[0],y:a[1]};return 2===Ct(n,!1).filter((function(t){var a=e[C(t)];return!(!a||!["GROUND"].includes(a.type))})).length})),n=0;n<t;){var r=E(a),i=r.split(",").map((function(e){return parseInt(e)})),s={x:i[0],y:i[1]},c=Ct(s,!1).filter((function(t){var a=e[C(t)];return!(!a||!["WALL"].includes(a.type))})),o=E(c);if(o){for(var u={x:Math.sign(o.x-s.x),y:Math.sign(o.y-s.y)},l=100,h=!0,d=Object(p.a)({},s),f=[];h;){d.x+=u.x,d.y+=u.y;var g=e[C(d)];if(!g)break;if("FLOOR"===g.type)g.type="WALL",f.push(Object(p.a)({},d));else if("GROUND"===g.type||"WALL"===g.type&&f.length){var y={x:d.x-2*u.x,y:d.y-2*u.y};e[C(y)].type="DOOR",y={x:d.x-3*u.x,y:d.y-3*u.y},e[C(y)].type="DOOR",f.length<=0&&t<=100&&(t+=1);break}(l-=1)<=0&&(h=!1)}n+=1}}},It=function(e){function t(e){var a=Object.assign({},e);return Object(c.a)(this,t),Object(u.a)(this,Object(l.a)(t).call(this,Object(p.a)({},a)))}return Object(h.a)(t,e),Object(o.a)(t,[{key:"initialize",value:function(){var e=this;Object(N.a)(Object(l.a)(t.prototype),"initialize",this).call(this);var a=Math.floor(this.game.mapWidth/2),n=Math.floor(this.game.mapHeight/2);!function(e,t,a){for(var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:12,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,i=(arguments.length>5&&void 0!==arguments[5]&&arguments[5],{}),s=kt(),c=1e3;s.length<n+1;){var o=xt(s);if(o){var u=At(o,t,a,r),l=Tt(e,u,r,0);l&&s.push(o)}if((c-=1)<=0)break}Pt(e),St(e,s.length)}(this.game.map,a,n),function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"GROUND",n=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0,s=0;s<r;s++)for(var c=0;c<i;c++)if(s>=e.y&&s<=e.y+(t-1)&&c>=e.x&&c<=e.x+(t-1)){var o="".concat(c,",").concat(s),u=0;Y[a].animation&&(u=A(0,Y[a].animation.length)),n[o]={type:a,currentFrame:u,entities:[]}}}({x:0,y:0},3,"SAFE",this.game.map,this.game.mapHeight,this.game.mapWidth),this.placeInitialItems(),this.placePlayersInSafeZone();for(var r=Object.keys(this.game.map).filter((function(t){return"FLOOR"===e.game.map[t].type})),i=0;i<this.data.debrisCount;i++){var s=E(r).split(",").map((function(e){return parseInt(e)}));this.addDebris({x:s[0],y:s[1]})}for(var c=0;c<this.data.gasCanCount;c++){var o=E(r).split(",").map((function(e){return parseInt(e)}));this.addDebris({x:o[0],y:o[1]},"gas can","X",1,3,K.orange)}for(var u=0;u<this.data.fireIntensity;u++){var h=E(r).split(",").map((function(e){return parseInt(e)}));this.addFire({x:h[0],y:h[1]})}for(var p=0;p<this.data.npcCount;p++){var d=E(r).split(",").map((function(e){return parseInt(e)}));this.addNPC({x:d[0],y:d[1]})}ye.fire_1.playing()||ye.fire_1.play()}},{key:"checkRemoveSafeFloors",value:function(){var e=this;"Fire Fighter"===this.game.engine.actors[this.game.engine.currentActor].name&&(this.data.turnCount+=1,this.data.turnCount>50*this.getSaveCountRequirement()&&Object.keys(this.game.map).filter((function(t){return"SAFE_FLOOR"==e.game.map[t].type})).forEach((function(t){e.game.map[t].type="FLOOR"})))}},{key:"update",value:function(){Object(N.a)(Object(l.a)(t.prototype),"update",this).call(this),this.propogateFire(),this.burnEntities(),this.checkRemoveSafeFloors(),this.hasLost()&&(this.reset(),this.game.initializeGameData()),this.hasWon()&&(this.nextLevel(),this.increaseIntensity(),this.game.initializeGameData())}},{key:"setLevel",value:function(e){this.data.level=e,this.data.turnCount=0}},{key:"nextLevel",value:function(){this.setLevel(this.data.level+1)}},{key:"reset",value:function(){this.resetIntensity(),this.setLevel(1),this.initialize()}},{key:"increaseIntensity",value:function(){switch(this.data.level){case 1:this.data.fireIntensity=1,this.data.npcCount=1,this.data.debrisCount=4,this.data.gasCanCount=0;break;case 2:this.data.fireIntensity=2,this.data.npcCount=1,this.data.debrisCount=4,this.data.gasCanCount=1;break;case 3:this.data.fireIntensity=3,this.data.npcCount=2,this.data.debrisCount=50,this.data.gasCanCount=1;break;case 4:this.data.fireIntensity=4,this.data.npcCount=2,this.data.debrisCount=6,this.data.gasCanCount=3;break;case 5:this.data.fireIntensity=5,this.data.npcCount=3,this.data.debrisCount=6,this.data.gasCanCount=3;break;case 6:this.data.fireIntensity=4,this.data.npcCount=3,this.data.debrisCount=10,this.data.gasCanCount=3;break;case 7:this.data.fireIntensity=1,this.data.npcCount=3,this.data.debrisCount=80,this.data.gasCanCount=25;break;case 8:this.data.fireIntensity=3,this.data.npcCount=3,this.data.debrisCount=20,this.data.gasCanCount=6;break;default:this.data.fireIntensity=3,this.data.npcCount=3,this.data.debrisCount=20,this.data.gasCanCount=5}}},{key:"resetIntensity",value:function(){this.data.fireIntensity=1,this.data.npcCount=1,this.data.debrisCount=4}},{key:"countNpcSafe",value:function(){var e=this;return this.game.engine.actors.filter((function(t){if(t.entityTypes.includes("HELPLESS")&&"SAFE"===e.game.map[C(t.pos)].type)return t.saved||t.save(),!0;return!1})).length}},{key:"getSaveCountRequirement",value:function(){var e=Math.ceil(.66*this.data.npcCount);return Math.max(1,e)}},{key:"hasWon",value:function(){return this.countNpcSafe()>=this.getSaveCountRequirement()}},{key:"hasLost",value:function(){return this.game.engine.actors.filter((function(e){return e.entityTypes.includes("HELPLESS")})).length<this.getSaveCountRequirement()&&(ye.lose.play(),this.game.toLose(),!0)}},{key:"addDebris",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"box",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"%",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:K.base01,s=E(["\ue83b","\ue873","\ue874","\ue875","\ue876","\ue877"]);r>0&&(s="\ue83a");var c=new Je({pos:e,renderer:{character:a,sprite:s,color:K.base2,background:i},name:t,game:this.game,durability:n,explosivity:r,flammability:0});this.game.placeActorOnMap(c),this.game.draw()}},{key:"addNPC",value:function(e){var t=new Ve({name:"Helpless Citizen",messages:["help!","ahh!","It's getting hot in hurr."],messageType:ue.ACTION,pos:e,game:this.game,renderer:{character:"C",sprite:"\ue823",color:K.base3,background:K.violet},durability:2});this.game.placeActorOnMap(t)&&(this.game.map[C(t.pos)].type="SAFE_FLOOR",this.game.engine.addActor(t),this.game.draw())}},{key:"addFire",value:function(e){var t=new et({name:"Pyro",pos:e,game:this.game,renderer:{character:"*",sprite:"\ue8bb",color:K.base3,background:K.red},timeToSpread:1,spreadCount:1,durability:1,attackDamage:2,speed:100});this.game.placeActorOnMap(t)&&(this.game.engine.addActor(t),this.game.draw())}},{key:"propogateFire",value:function(){var e=this;if(this.game.engine.actors.filter((function(e){return"Pyro"===e.name})).length<this.data.fireIntensity){var t=Object.keys(this.game.map).filter((function(t){return"BURNT"==e.game.map[t].type})),a=E(t);if(a){var n={x:parseInt(a.split(",")[0]),y:parseInt(a.split(",")[1])};this.addFire(n)}}}},{key:"burnEntities",value:function(){var e=this;Object.keys(this.game.map).filter((function(t){return"BURNT"===e.game.map[t].type})).reduce((function(t,a){return t.concat(e.game.map[a].entities)}),[]).forEach((function(t){t.entityTypes.includes("BURNABLE")&&(t.burn()&&e.game.addMessage("".concat(t.name," is burned."),ue.DANGER),t.willResetCanBurn&&t.resetCanBurn())}))}},{key:"placeInitialItems",value:function(){var e,t=this,a=[(e=this.game.engine,new Ze({game:e.game,name:he,passable:!0,attackDamage:5,equipmentType:ee,renderer:{character:"a",sprite:"\ue888",color:"white",background:""}})),de(this.game.engine),fe(this.game.engine)],n=Object.keys(this.game.map).filter((function(e){return"SAFE"==t.game.map[e].type}));a.forEach((function(e){var a=n.pop();if(a){var r={x:parseInt(a.split(",")[0]),y:parseInt(a.split(",")[1])};e.pos=r;var i=t.game.map[a];i&&i.entities.push(e)}}))}},{key:"placePlayersInSafeZone",value:function(){var e=this,t=this.game.engine.actors.filter((function(e){return e.entityTypes.includes("PLAYING")})),a=Object.keys(this.game.map).filter((function(t){return"SAFE"==e.game.map[t].type}));t.forEach((function(t){var n=a.shift();if(n){var r={x:parseInt(n.split(",")[0]),y:parseInt(n.split(",")[1])};t.pos=r;var i=e.game.map[n];i&&i.entities.push(t)}}))}}]),t}(function(){function e(t){var a=t.game,n=void 0===a?null:a,r=t.data,i=void 0===r?{}:r;Object(c.a)(this,e);var s=_()();this.id=s,this.game=n,this.data=i}return Object(o.a)(e,[{key:"initialize",value:function(){}},{key:"update",value:function(){}}]),e}()),Rt=function(){function e(t){var a=t.engine,n=void 0===a?null:a,r=t.map,i=void 0===r?{}:r,s=t.mapInitialized,o=void 0!==s&&s,u=t.tileMap,l=void 0===u?{}:u,h=t.mapWidth,p=void 0===h?50:h,d=t.mapHeight,f=void 0===d?25:d,g=t.getSelectedCharacter,y=void 0===g?function(){return!1}:g,m=t.display,b=void 0===m?new jt({containerId:"display",width:1505,height:755,tileWidth:30,tileHeight:30,tileOffset:5,cameraFollow:!1,game:this}):m,v=t.spriteMode,O=void 0===v||v,j=t.tileKey,k=void 0===j?Y:j,x=t.mode,w=void 0===x?new It({game:this,data:{level:1,highestLevel:null,fireIntensity:1,npcCount:1,debrisCount:4,gasCanCount:0,turnCount:0}}):x,E=t.messages,A=void 0===E?[]:E;Object(c.a)(this,e),this.engine=n,this.map=i,this.mapInitialized=o,this.tileMap=l,this.mapWidth=p,this.mapHeight=f,this.display=b,this.spriteMode=O,this.tileKey=k,this.mode=w,this.messages=A,this.getSelectedCharacter=y}return Object(o.a)(e,[{key:"initializeMode",value:function(){this.mode.initialize()}},{key:"updateMode",value:function(){this.mode.update()}},{key:"randomlyPlaceActorOnMap",value:function(e){for(var t=0,a=!1;!a;){var n=S(this.map).coordinates;if(this.canOccupyPosition(n,e)){var r=this.map[C(n)];e.pos=Object(p.a)({},n),r.entities.push(e),a=!0}(t+=1)>=100&&(a=!0)}return a}},{key:"randomlyPlaceAllActorsOnMap",value:function(){var e=this;this.engine.actors.forEach((function(t){e.randomlyPlaceActorOnMap(t)}))}},{key:"placeActorsOnMap",value:function(){var e=this;this.engine.actors.forEach((function(t){var a=e.map[C(t.pos)];a?a.entities.push(t):console.log("could not place ".concat(t.id,": ").concat(t.name," on map"))}))}},{key:"placeActorOnMap",value:function(e){var t=this.map[C(e.pos)];return t?(t.entities.push(e),!0):(console.log("could not place ".concat(e.id,": ").concat(e.name," on map")),!1)}},{key:"removeActorFromMap",value:function(e){var t=this.map[C(e.pos)];return!!t&&(this.map[C(e.pos)].entities=t.entities.filter((function(t){return t.id!==e.id})),!0)}},{key:"createLevel",value:function(){var e=new x.d.Arena(this.mapWidth,this.mapHeight),t=[];e.create(function(e,a,n){var r=e+","+a,i="GROUND",s=0;n&&(i="WALL"),Y[i].animation&&(s=A(0,Y[i].animation.length)),this.map[r]={type:i,currentFrame:s,entities:[]},t.push(r)}.bind(this)),this.randomlyPlaceAllActorsOnMap()}},{key:"createEmptyLevel",value:function(){for(var e=0;e<this.mapHeight;e++)for(var t=0;t<this.mapWidth;t++){var a="".concat(t,",").concat(e),n=0;Y.GROUND.animation&&(n=A(0,Y.GROUND.animation.length)),this.map[a]={type:"GROUND",currentFrame:n,entities:[]}}}},{key:"createCustomLevel",value:function(e){var t=this;Object.keys(e.tiles).forEach((function(a,n){var r=e.tiles[a],i=JSON.parse(r.data),s=0;i||(i="GROUND"),Y[i].animation&&(s=A(0,Y[i].animation.length)),t.map[a]={type:i,currentFrame:s,entities:[]}})),this.placeInitialEntities()}},{key:"canOccupyPosition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{passable:!1},a=!1,n=this.map[C(e)];if(n){var r=n.entities.filter((function(e){return!e.passable})).length>0;if(!r||t.passable){var i=this.map[C(e)];this.tileKey[i.type].passable&&(a=!0)}}return a}},{key:"cursorCanOccupyPosition",value:function(e){var t=!1;return this.map[C(e)]&&(t=!0),t}},{key:"show",value:function(e){this.display.initialize(e)}},{key:"processTileMap",value:function(e){for(var t in this.map){var a=t.split(","),n=parseInt(a[0]),r=parseInt(a[1]),i=this.map[t],s=this.tileKey[i.type],c=this.animateTile(i,s),o=c.character,u=c.foreground,l=c.background;if(i.entities.length>0){var h=i.entities[i.entities.length-1];o=(c=this.animateEntity(h)).character,u=c.foreground,c.background&&(l=c.background)}e(t,n,r,o,u,l)}}},{key:"initializeMap",value:function(){var e=this;if(this.mapInitialized)return!1;this.mapInitialized=!0,this.processTileMap((function(t,a,n,r,i,s){var c=e.display.createTile(a,n,r,i,s);e.tileMap[t]=c})),this.display.draw()}},{key:"getPlayers",value:function(){return this.engine.actors.filter((function(e){return e.entityTypes.includes("PLAYING")}))}},{key:"draw",value:function(){var e=this;this.processTileMap((function(t,a,n,r,i,s){e.display.updateTile(e.tileMap[t],r,i,s)}));var t=null,a=this.getPlayers();a.length&&(t=a[0].pos),this.display.draw(t)}},{key:"getEntityRenderer",value:function(e){return this.spriteMode&&e.hasOwnProperty("sprite")?Object(p.a)({},e,{character:e.sprite,foreground:e.color}):Object(p.a)({},e,{foreground:e.color})}},{key:"getTileRenderer",value:function(e){return this.spriteMode&&e.hasOwnProperty("sprite")?Object(p.a)({},e,{character:e.sprite}):e}},{key:"animateEntity",value:function(e){var t=e.renderer,a=this.getEntityRenderer(t),n=a.character,r=a.foreground,i=a.background;if(t.animation){var s=this.getEntityRenderer(t.animation[e.currentFrame]);n=s.character,r=s.foreground,i=s.background,e.currentFrame=(e.currentFrame+1)%t.animation.length}return{character:n,foreground:r,background:i}}},{key:"animateTile",value:function(e,t){var a=this.getTileRenderer(t),n=a.character,r=a.foreground,i=a.background;if(t.animation){var s=this.getTileRenderer(t.animation[e.currentFrame]);n=s.character,r=s.foreground,i=s.background,e.currentFrame=(e.currentFrame+1)%t.animation.length}return{character:n,foreground:r,background:i}}},{key:"addActor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.engine,a=this.placeActorOnMap(e);return!!a&&(t.actors.push(e),this.draw(),!0)}},{key:"placeAndDrawActor",value:function(e){this.placeActorsOnMap(),this.draw()}},{key:"removeActor",value:function(e){this.engine.actors=this.engine.actors.filter((function(t){return t.id!==e.id})),this.removeActorFromMap(e),this.draw()}},{key:"initializeUI",value:function(e,t){this.show(t),e.current.focus()}},{key:"initializeGameData",value:function(){var e=this;this.engine.game=this;var t=this.getSelectedCharacter();this.engine.actors=[t],this.engine.actors.forEach((function(t){t.game=e})),this.createEmptyLevel(),this.initializeMap(),this.draw(),this.mode.initialize()}},{key:"initialize",value:function(e,t){var a=this;this.initializeUI(e,t),this.initializeGameData(),setTimeout((function(){a.spriteMode=!1,a.draw()}),100),setTimeout((function(){a.spriteMode=!0,a.draw()}),100)}},{key:"addMessage",value:function(e,t){var a=new le({text:e,type:t});this.messages.push(a)}}]),e}(),Dt=function(e,t){if(!t.isRunning){var a=t.actors[t.currentActor].keymap,n=e.key;if(!(n in a))return;a[n].activate(),t.start()}},Nt=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this,t=null;try{t=r.a.createElement("span",null,r.a.createElement("div",{className:"Instructions__block"},"Wave ".concat(this.props.game.mode.data.level)),r.a.createElement("div",{className:"Instructions__block"},"".concat(this.props.game.mode.countNpcSafe()," of  ").concat(this.props.game.mode.getSaveCountRequirement()," are safe!")))}catch(a){return}return r.a.createElement("div",{className:"Instructions UI"},r.a.createElement("p",{className:"flow-text"},"Save all of the citizens from the burning keep and get them to the safe zone!"),r.a.createElement("div",{className:"flow-text"},t,r.a.createElement("div",{className:"Instructions__block",onClick:function(){return e.props.setActiveScreen(g)}},r.a.createElement("button",{className:"btn btn-main"},"Restart")),r.a.createElement("div",{className:"Instructions__block",onClick:function(){return e.props.toggleSpriteMode()}},r.a.createElement("button",{className:"btn btn-main"},this.props.spriteMode?"ASCII mode":"Sprite mode"))))}}]),t}(r.a.Component);var Lt=function(e){var t=e.color;return t||(t="grey"),r.a.createElement("button",{onClick:e.onClick,className:"Button btn ".concat(t)},e.children)},Mt=(r.a.Component,r.a.Component,r.a.Component,a(24)),_t=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"Keymap UI"},r.a.createElement("div",{className:"flow-text center"},"Keymap"),this.props.keymap&&Object.entries(this.props.keymap).map((function(e,t){var a=Object(Mt.a)(e,2),n=a[0],i=a[1];if(!(!!i.hasOwnProperty("hidden")&&i.hidden))return r.a.createElement(Lt,{key:t,onClick:function(){return null},color:"grey darken-1"},n," ",i.label)})))}}]),t}(r.a.Component);function Bt(e){return r.a.createElement("div",{className:"Message",style:{color:e.color,backgroundColor:e.backgroundColor,borderColor:e.color}},e.children)}var Gt,Ut,Ft=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"Messages UI"},r.a.createElement("div",{className:"flow-text center"},"Messages"),this.props.messages&&this.props.messages.map((function(e,t){return r.a.createElement(Bt,{key:t,color:e.type.color,backgroundColor:e.type.backgroundColor},"".concat(e.text))})))}}]),t}(r.a.Component),Wt=function(e){function t(e){var a;Object(c.a)(this,t),a=Object(u.a)(this,Object(l.a)(t).call(this,e));var n=new ht({}),i=new Rt({engine:n,getSelectedCharacter:function(){return a.props.selectedCharacter.initialize(n)}});return a.state={game:i,activeTab:0,spriteMode:i.spriteMode},a.presserRef=r.a.createRef(),a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=Object(k.a)(j.a.mark((function e(){var t=this;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.state.game.initialize(this.presserRef,document),this.state.game.backToTitle=function(){return t.props.setActiveScreen(g)},this.state.game.toLose=function(){return t.props.setActiveScreen(m)},this.state.game.updateReact=function(e){t.setState({game:e})},this.state.game.engine.start();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toggleSpriteMode",value:function(){this.state.game.spriteMode=!this.state.game.spriteMode,this.state.game.draw(),this.presserRef.current.focus(),this.setState({spriteMode:this.state.game.spriteMode})}},{key:"render",value:function(){var e,t,a,n=this,i=(this.state.game.engine.actors[this.state.game.engine.currentActor],[{label:"Wave",value:"Current: ".concat(this.state.game.mode.data.level,", Highest: ").concat(this.state.game.mode.data.highestLevel)}]);return i=i.concat(Object(v.a)(this.state.game.engine.actors.map((function(e,t){var a=Object(b.a)({label:e.name,value:t},"value","HP: ".concat(e.durability,", En/Sp: ").concat(e.energy,"/").concat(e.speed));return t===n.state.game.engine.currentActor&&(a.color="red"),a})))),r.a.createElement("div",{className:"Level"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col s10"},r.a.createElement("div",{className:"game_display_container"},(e=this.presserRef,t=Dt,a=this.state.game.engine,r.a.createElement("div",{id:"display",ref:e,onKeyDown:function(e){return t(e,a)},tabIndex:"0"}))),r.a.createElement(Nt,{game:this.state.game,spriteMode:this.state.game.spriteMode,setActiveScreen:this.props.setActiveScreen,toggleSpriteMode:this.toggleSpriteMode.bind(this)})),r.a.createElement("div",{className:"col s2"},r.a.createElement(_t,{keymap:this.state.game.visibleKeymap}),r.a.createElement(Ft,{messages:this.state.game.messages.slice(-5).reverse()}))))}}]),t}(r.a.Component),Ht=function(e){return r.a.createElement("div",{className:"CharacterSelect"},e.characters.map((function(t,a){return e.selectedCharacter&&(e.selectedCharacter.name===t.name?"red":""),r.a.createElement("button",{key:a,style:{position:"relative",top:"280px"},className:"CharacterSelect__button btn btn-main",onClick:function(){e.setSelectedCharacter(t),e.setActiveScreen(y)}},"Play Game")})))},qt=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"Title"},r.a.createElement("div",{style:{width:"100vw",height:"100vh",backgroundColor:"rgb(4, 49, 61)",backgroundImage:'url("'.concat(window.PUBLIC_URL,'/fire_man_blue.jpg")'),backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundPositionY:"10px"}},r.a.createElement(Ht,{characters:this.props.characters,selectedCharacter:this.props.selectedCharacter,setSelectedCharacter:this.props.setSelectedCharacter,setActiveScreen:this.props.setActiveScreen})))}}]),t}(r.a.Component),zt=function(e){return r.a.createElement("div",{className:"CharacterSelect"},e.characters.map((function(t,a){return e.selectedCharacter&&(e.selectedCharacter.name===t.name?"red":""),r.a.createElement("button",{key:a,style:{position:"relative",top:"280px"},className:"CharacterSelect__button btn btn-main",onClick:function(){e.setSelectedCharacter(t),e.setActiveScreen(y)}},"You Lost. Try Again?")})))},Kt=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},a}return Object(h.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"Title"},r.a.createElement("div",{style:{width:"100vw",height:"100vh",backgroundColor:"#222",backgroundImage:'url("'.concat(window.PUBLIC_URL,'/fire_man_blue.jpg")'),backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundPositionY:"10px"}},r.a.createElement(zt,{characters:this.props.characters,selectedCharacter:this.props.selectedCharacter,setSelectedCharacter:this.props.setSelectedCharacter,setActiveScreen:this.props.setActiveScreen})))}}]),t}(r.a.Component),Yt=function(e){return new Qe({pos:{x:19,y:22},renderer:{character:"F",sprite:"\ue828",color:K.base3,background:K.yellow},name:"Fire Fighter",equipment:ae(),actions:[],speed:100,durability:4,keymap:function(e){return Object(p.a)({},rt(ot,e,"push",!0),{t:{activate:function(){return function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=e.actors[e.currentActor],r=e.game,i=n.pos;n.canBurn=!1;var s=new Xe({initiatedBy:n,range:a,pos:i,renderer:{character:"\u2588",color:"white",background:""},name:"Cursor",game:r,keymap:ct(e,n,Object(p.a)({},n.keymap),t)});e.addActorAsPrevious(s),r.placeActorOnMap(s),r.draw()}(e,1,5)},label:"shoot water"},c:{activate:function(){return ut(e)},label:"chop"},e:{activate:function(){return it(e)},label:"equipment"},p:{activate:function(){return function(e){var t=e.actors[e.currentActor],a=e.game.map[C(t.pos)].entities.filter((function(e){return e.id!==t.id}));a.length>0?t.setNextAction(new Oe({item:E(a),game:e.game,actor:t,energyCost:100})):e.game.addMessage("nothing to equip.",ue.ACTION)}(e)},label:"pick up"},g:{activate:function(){return function(e){var t=e.game,a=e.actors[t.engine.currentActor],n=a.keymap,r=[];[X.N,X.E,X.S,X.W].forEach((function(t){var n={x:a.pos.x+t[0],y:a.pos.y+t[1]},i=e.game.display.addAnimation(1,{x:n.x,y:n.y,color:K.base3});r.push(i)})),a.keymap=lt(e,a,n,r)}(e)},label:"grab"},r:{activate:function(){return function(e){var t=e.actors[e.currentActor];t.setNextAction(new Pe({game:e.game,actor:t,energyCost:100}))}(e)},label:"release"}})}(e)})},Xt=function(){return{FireFighter:Yt}},Vt=function(e){function t(){var e;Object(c.a)(this,t),e=Object(u.a)(this,Object(l.a)(t).call(this));var a=Xt(),n=Object.keys(a).map((function(e,t){return{initialize:a[e],selected:!1,name:e}}));return e.state={activeScreen:g,characters:n,selectedCharacter:null},e}return Object(h.a)(t,e),Object(o.a)(t,[{key:"setActiveScreen",value:function(e){e===g&&Object.keys(ye).forEach((function(e){ye[e].stop()})),this.setState({activeScreen:e})}},{key:"setSelectedCharacter",value:function(e){this.setState({selectedCharacter:Object(p.a)({},e)})}},{key:"getActiveScreen",value:function(){var e=r.a.createElement(qt,{key:g,setActiveScreen:this.setActiveScreen.bind(this),setSelectedCharacter:this.setSelectedCharacter.bind(this),selectedCharacter:this.state.selectedCharacter,characters:this.state.characters}),t=r.a.createElement(Kt,{key:m,setActiveScreen:this.setActiveScreen.bind(this),setSelectedCharacter:this.setSelectedCharacter.bind(this),selectedCharacter:this.state.selectedCharacter,characters:this.state.characters}),a=r.a.createElement(Wt,{key:y,setActiveScreen:this.setActiveScreen.bind(this),selectedCharacter:this.state.selectedCharacter});switch(this.state.activeScreen){case g:return e;case m:return t;case y:return a;default:return e}}},{key:"render",value:function(){var e=this.getActiveScreen();return r.a.createElement("div",{className:"Nystrum"},r.a.createElement(f.a,{transitionName:"fade",transitionAppear:!0,transitionEnter:!0,transitionLeave:!0,transitionAppearTimeout:500,transitionEnterTimeout:500,transitionLeaveTimeout:300},e))}}]),t}(r.a.Component),Jt=function(e,t){for(var a in e){var n=a.split(","),r=parseInt(n[0]),i=parseInt(n[1]),s=e[a],c={GROUND:{background:"#974",foreground:"#aaa",character:".",passable:!0}}[s.type],o=c.character,u=c.foreground,l=c.background;if(s.entities.length>0){var h=s.entities[s.entities.length-1];o=h.components.renderer.character,u=h.components.renderer.color,h.components.renderer.background&&(l=h.components.renderer.background)}t.draw(r,i,o,u,l)}},Qt=function(e){return"".concat(e.x,",").concat(e.y)},Zt=function(e){return e.filter((function(e){return e.components.hasOwnProperty("impasse")&&!e.components.impasse.passable}))},$t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;return new Promise((function(t){return setTimeout(t,e)}))},ea=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Empty",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0,r={id:e,name:t,components:a,world:n,sendEvent:function(e,t,a){return ta(e,t,a,n)}};return r},ta=function(){var e=Object(k.a)(j.a.mark((function e(){var t,a,n,r,i,s,c,o=arguments;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=o.length>0&&void 0!==o[0]?o[0]:null,a=o.length>1&&void 0!==o[1]?o[1]:null,n=o.length>2&&void 0!==o[2]?o[2]:null,r=o.length>3&&void 0!==o[3]?o[3]:null,i=!1,e.t0=j.a.keys(t.components);case 6:if((e.t1=e.t0()).done){e.next=19;break}if(s=e.t1.value,!(c=t.components[s]).hasOwnProperty(a)){e.next=17;break}if(console.log("SUCCESSFUL EVENT: ",a),i=!0,"PREPARE_RENDER"===a){e.next=15;break}return e.next=15,$t();case 15:c[a](Object(p.a)({},n,{self:t,component:c})),Jt(r.map,r.display);case 17:e.next=6;break;case 19:i||console.log("FAILED EVENT");case 20:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),aa=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return{passable:e,MAKE_PASSABLE:function(e){e.component.passable=!0},MAKE_IMPASSABLE:function(e){e.component.passable=!1}}},na=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0};return e?{pos:t,MOVE:function(t){var a=t.self,n=t.component,r=t.currentPos,i=t.targetPos;if(e.canOccupy(e.map,i)){n.pos=i;var s=e.map[Qt(r)];e.map[Qt(r)]=Object(p.a)({},s,{entities:[]}),a.sendEvent(a,"PREPARE_RENDER")}else console.log("can't move there")}}:(console.log("No world to occupy"),{})},ra=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return{durability:t,DECREASE_DURABILITY:function(e){var t=e.self,a=e.component,n=e.value;a.durability-=n,a.durability<=0&&t.sendEvent(t,"DESTROY")},INCREASE_DURABILITY:function(e){var t=e.component,a=e.value;t.durability+=a},DESTROY:function(t){var a=t.self,n=(t.component,t.value,e.map[Qt(a.components.body.pos)]);e.map[Qt(a.components.body.pos)].entities=n.entities.filter((function(e){return e.id!==a.id}))}}},ia=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"white",n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return{character:t,color:a,background:n,PREPARE_RENDER:function(t){var a=t.self;a.components.hasOwnProperty("body")&&e.map[Qt(a.components.body.pos)].entities.push(a)}}},sa=new x.g.Simple,ca={canAct:!0,scheduler:sa,engine:new x.c(sa),map:{},display:new x.b({fontSize:24,bg:"#099"}),canOccupy:function(e,t){if(!e.hasOwnProperty(Qt(t)))return!1;var a=e[Qt(t)];return!(!{GROUND:{background:"#974",foreground:"#aaa",character:".",passable:!0}}[a.type].passable||0!==Zt(a.entities).length)||void 0}},oa=Object(p.a)({},ea(1,"Naruto",{reciever:(Gt={x:10,y:30},{responded:!1,RECIEVE:function(e){var t=e.self,a=e.component,n=e.message;console.log(n,Gt.x,Gt.y),a.responded||(a.responded=!0,t.sendEvent(e.sender,"hello","RECIEVE",{message:"copy",sender:t}))}}),body:na(ca,{x:19,y:21}),renderer:ia(ca,"N","orange","black")},ca)),ua=Object(p.a)({},ea(2,"Box",{body:na(ca,{x:22,y:21}),renderer:ia(ca,"#","black"),impasse:aa(),destructible:ra(ca)},ca)),la=Object(p.a)({},ea(2,"Box",{body:na(ca,{x:22,y:19}),renderer:ia(ca,"#","black"),impasse:aa(),destructible:ra(ca)},ca)),ha=Object(p.a)({},ea(2,"Box",{body:na(ca,{x:22,y:17}),renderer:ia(ca,"#","black"),impasse:aa(),destructible:ra(ca)},ca)),pa=Object(p.a)({},ea(3,"Kunai",{body:na(ca,{x:20,y:21}),renderer:ia(ca,"<>","black"),destructible:ra(ca),attack:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return{damage:e}}(),throwable:(Ut=ca,{THROW:function(e){var t=e.self,a=(e.component,e.direction),n=t.components.body.pos,r={x:n.x+a.x,y:n.y+a.y},i=Ut.map[Qt(r)];if(Ut.canOccupy(Ut.map,r))t.sendEvent(t,"MOVE",{currentPos:n,targetPos:r}),t.sendEvent(t,"THROW",{direction:a});else{if(Ut.map.hasOwnProperty(Qt(r))){var s=Zt(i.entities).filter((function(e){return e.components.hasOwnProperty("destructible")}));s.length>0&&t.sendEvent(s[0],"DECREASE_DURABILITY",{value:1})}t.sendEvent(t,"DECREASE_DURABILITY",{value:1})}}})},ca)),da=(r.a.Component,function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"App container-fluid"},r.a.createElement(Vt,null))}}]),t}(r.a.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(da,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},88:function(e,t,a){}},[[143,1,2]]]);
//# sourceMappingURL=main.c8444e3c.chunk.js.map